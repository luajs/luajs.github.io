(function(){function D(e){return z[/\.\/(\w*)\.js/.exec(e)[1]]}var z={lex:{},parser:{},codegen:{},types:{},index:{}};(function(e){function c(c){return d.test(c)}function v(d){return"\n"==d||"\r"==d}function g(d,c,g){var e=0,l=d();if("["!=l&&"]"!=l)throw"Lexical internal error!";g&&g(l);for(c();"="==d();)c(),g&&g(d()),++e;return d()==l?e:-e-1}function l(d,c){var g=d();c();v(d())&&d()!=g&&c()}function k(d,c,e){function h(d){k.push(d)}var k=[];c();for(v(d())&&l(d,c);;){var m=d();switch(m){case null:throw"unfinished long string/comment";
case "]":if(g(d,c,h)==e)return c(),k.splice(-e-1,e+1),k.join("");break;case "\n":case "\r":l(d,c);h("\n");break;default:h(m),c()}}}function h(d,u){for(;;)switch(d()){case "\n":case "\r":case " ":case "\f":case "\t":case "\t":u();break;case "-":u();if("-"!=d())return"-";u();var e=d();if("["==e){var h=g(d,u);if(0<=h){k(d,u,h);break}}for(;e&&"\n"!=e&&"\r"!=e;)u(),e=d();break;case "[":h=g(d,u);if(0<=h)return{id:w.TK_STRING,val:k(d,u,h)};if(-1==h)return"[";throw"invalid long string delimiter";case "=":u();
if("="!=d())return"=";u();return w.TK_EQ;case "<":u();if("="!=d())return"<";u();return w.TK_LE;case ">":u();if("="!=d())return">";u();return w.TK_GE;case "~":u();if("="!=d())return"~";u();return w.TK_NE;case ":":u();if(":"!=d())return":";u(ls);return w.TK_DBCOLON;case '"':case "'":var e=w.TK_STRING,h=d,n=u,x=[],A=h();n();for(var v=void 0;(v=h())!=A;)switch(v){case null:throw"unfinished string";case "\n":case "\r":throw"unfinished string";case "\\":n();v=h();switch(v){case "b":x.push("\b");n();break;
case "f":x.push("\f");n();break;case "n":x.push("\n");n();break;case "r":x.push("\r");n();break;case "t":x.push("\t");n();break;case "v":x.push("\t");n();break;case "\n":case "\r":x.push("\n");l();break;case "\\":case '"':case "'":x.push(v);n();break;case null:throw"unfinished string";case "z":for(n();lisspace(h());)n();break;case "x":throw"esacpe for char code not supported in lua.js yet.";default:if(!m.test(v))throw"invalid escape sequence"+v;throw"esacpe for char code not supported in lua.js yet.";
}break;default:x.push(v),n()}n();h=x.join("");return{id:e,val:h};case ".":u();if("."==d())return u(),"."==d()?(u(),w.TK_DOTS):w.TK_CONCAT;e=d();if(!m.test(e))return".";case "0":case "1":case "2":case "3":case "4":case "5":case "6":case "7":case "8":case "9":e=w.TK_NUMBER;h=d;n=u;x=h();n();if("0"!=x||"x"!=h()&&"X"!=h()){x=[x];for(A=h();m.test(A)||"."==A;)x.push(A),n(),A=h();h=parseFloat(x.join(""))}else throw n(),Error("Hexadecimal numeric not supported in lua.js yet.");return{id:e,val:h};case null:return w.TK_EOS;
default:e=d();if(B.test(e)){e=d;h=u;for(n=[];c(e());)n.push(e()),h();e=n.join("");return(h="number"==typeof r[e]&&r[e])?h:{id:w.TK_NAME,val:e}}e=d();u();return e}}function n(d){function c(){return e<d.length?d.charAt(e):null}function g(){e<d.length&&++e}var e=0;return function(){return h(c,g)}}e.tokens="<eof> and break do else elseif end false for function goto if in local nil not or repeat return then true until while .. ... == >= <= ~= :: <--orgion-eof> <number> <name> <string> __javascript __jsreturn".split(" ");
var r={and:1,"break":2,"do":3,"else":4,elseif:5,end:6,"false":7,"for":8,"function":9,"goto":10,"if":11,"in":12,local:13,nil:14,not:15,or:16,repeat:17,"return":18,then:19,"true":20,until:21,"while":22,__javascript:34,__js:34,__jsreturn:35},w={TK_EOS:0,TK_AND:1,TK_BREAK:2,TK_DO:3,TK_ELSE:4,TK_ELSEIF:5,TK_END:6,TK_FALSE:7,TK_FOR:8,TK_FUNCTION:9,TK_GOTO:10,TK_IF:11,TK_IN:12,TK_LOCAL:13,TK_NIL:14,TK_NOT:15,TK_OR:16,TK_REPEAT:17,TK_RETURN:18,TK_THEN:19,TK_TRUE:20,TK_UNTIL:21,TK_WHILE:22,TK_CONCAT:23,TK_DOTS:24,
TK_EQ:25,TK_GE:26,TK_LE:27,TK_NE:28,TK_DBCOLON:29,TK_NUMBER:31,TK_NAME:32,TK_STRING:33,TK_JAVASCRIPT:34,TK_JSRETURN:35};e.TK=w;var B=/^[A-Za-z\_]$/,m=/^[0-9]$/,d=/^[0-9A-Za-z\_]$/;e.generator=n;e.lex=function(d){var c=n(d),g=c(),e=c();return{curr:function(){return g},lookAhead:function(){return e},next:function(){g=e;e=c()}}}})(z.lex);(function(e){function c(d){switch(typeof d){case "string":case "number":return d;case "object":return d.id}}function v(d){return"number"==typeof d?F[d]:"object"==typeof d?
F[d.id]:d}function g(d){k(d,q.TK_NAME);var c=d.curr().val;d.next();return{type:"variable",val:c}}function l(d,g){if(c(d.curr())==g)return d.next(),!0}function k(d,g){if(c(d.curr())!=g)throw Error("symbol "+v(g)+" expected!");}function h(d,c){k(d,c);d.next()}function n(d){k(d,q.TK_NAME);var c=d.curr().val;d.next();return c}function r(d){return{type:"const.string",val:n(d)}}function w(d){k(d,q.TK_STRING);var c=d.curr().val;d.next();return{type:"const.string",val:c}}function B(d){d.next();var c=y(d,
0);h(d,"]");return c}function m(d){switch(c(d.curr())){case "(":d.next();if(")"==d.curr())return d.next(),[];var g=E(d);h(d,")");return g;case "{":return[x(d)];case q.TK_STRING:return[w(d)];default:throw Error("function arguments expected, got "+v(d.curr()));}}function d(d){var p;a:switch(p=c(d.curr()),p){case "(":d.next();p=y(d,0);h(d,")");p={type:"expr.brackets",expr:p};break a;case q.TK_NAME:p=g(d);break a;case q.TK_JAVASCRIPT:d.next();p={type:"expr.javascript",args:m(d)};break a;default:throw Error("unexpected symbol "+
(F[p]||p));}for(;;)switch(c(d.curr())){case ".":d.next();var e=r(d);p={type:"expr.index",self:p,key:e};break;case "[":e=B(d);p={type:"expr.index",self:p,key:e};break;case ":":d.next();var e=r(d),u=m(d);p={type:"expr.callMethod",self:p,key:e,args:u};break;case "(":case "{":case q.TK_STRING:u=m(d);p={type:"expr.call",func:p,args:u};break;default:return p}}function p(d){switch(d.curr()){case "+":return 1;case "-":return 2;case "*":return 3;case "/":return 4;case "%":return 5;case "^":return 6;case q.TK_CONCAT:return 7;
case q.TK_EQ:return 8;case "<":return 9;case q.TK_LE:return 10;case q.TK_NE:return 11;case ">":return 12;case q.TK_GE:return 13;case q.TK_AND:return 14;case q.TK_OR:return 15}}function u(g){switch(c(g.curr())){case q.TK_NUMBER:var p=g.curr().val;g.next();return{type:"const.number",val:p};case q.TK_STRING:return w(g);case q.TK_NIL:return g.next(),{type:"const.nil"};case q.TK_TRUE:return g.next(),{type:"const.boolean",val:!0};case q.TK_FALSE:return g.next(),{type:"const.boolean",val:!1};case q.TK_DOTS:return g.next(),
{type:"vararg"};case "{":return x(g);case q.TK_FUNCTION:return g.next(),z(g);default:return d(g)}}function y(d,c){var g,e;a:{switch(d.curr()){case q.TK_NOT:e="uop.not";break a;case "-":e="uop.minus";break a;case "#":e="uop.len";break a}e=void 0}e?(d.next(),g=y(d,M),g={type:"expr.uop",op:e,operand:g}):g=u(d);for(e=p(d);e&&J[e][0]>c;){d.next();var h=y(d,J[e][1]);g={type:"expr.op",op:K[e],left:g,right:h};e=p(d)}return g}function E(d){var c=[];for(c.push(y(d,0));l(d,",");)c.push(y(d,0));return c}function H(d){var g;
g=c(d.curr())==q.TK_NAME?r(d):B(d);h(d,"=");return{type:"field.rec",key:g,val:y(d,0)}}function x(d){h(d,"{");var g=[];do{if("}"==d.curr())break;var p;a:{p=d;var e=p.curr();switch(c(e)){case q.TK_NAME:p="="!=p.lookAhead()?{type:"field.list",val:y(p,0)}:H(p);break a;case "[":p=H(p);break a;default:p={type:"field.list",val:y(p,0)}}}p&&g.push(p)}while(l(d,",")||l(d,";"));h(d,"}");return{type:"expr.constructor",fields:g}}function A(d,c){var g={type:c?"stat.jsreturn":"stat.return",nret:[]};d.next();L(d)||
";"==d.curr()||(g.nret=E(d));for(;l(d,";"););return g}function I(c){switch(c.curr()){case ";":c.next();break;case q.TK_IF:var p={type:"stat.if"},e=p;c.next();var u=e;u.cond=y(c,0);h(c,q.TK_THEN);for(u.tblock=C(c);l(c,q.TK_ELSEIF);){e.fblock={type:"block",stats:[{type:"stat.if"}]};var e=e.fblock.stats[0],u=c,k=e;k.cond=y(u,0);h(u,q.TK_THEN);k.tblock=C(u)}l(c,q.TK_ELSE)&&(e.fblock=C(c));h(c,q.TK_END);return p;case q.TK_WHILE:return c.next(),p=y(c,0),h(c,q.TK_DO),e=C(c),h(c,q.TK_END),{type:"stat.while",
cond:p,block:e};case q.TK_DO:return c.next(),p=C(c),h(c,q.TK_END),p;case q.TK_FOR:c.next();e=n(c);switch(c.curr()){case "=":c.next();u=y(c,0);h(c,",");k=y(c,0);l(c,",")&&(p=y(c,0));p={type:"stat.fornum",varname:e,from:u,to:k,step:p};break;case ",":case q.TK_IN:for(p=[e];l(c,",");)p.push(n(c));h(c,q.TK_IN);p={type:"stat.forlist",varnames:p,explist:E(c)};break;default:throw"`=` or `in` expected";}h(c,q.TK_DO);p.block=C(c);h(c,q.TK_END);return p;case q.TK_REPEAT:return c.next(),p=C(c),h(c,q.TK_UNTIL),
{type:"stat.repeat",until:y(c,0),block:p};case q.TK_FUNCTION:c.next();for(p=g(c);l(c,".");)e=r(c),p={type:"expr.index",self:p,key:e};l(c,":")?(e=r(c),p={type:"stat.method",self:p,key:e}):p={type:"stat.function",left:p};p.func=z(c);return p;case q.TK_LOCAL:c.next();if(l(c,q.TK_FUNCTION))return{type:"stat.localfunction",name:n(c),func:z(c)};p=[];do p.push(n(c));while(l(c,","));l(c,"=")&&(e=E(c));return{type:"stat.local",names:p,right:e};case q.TK_RETURN:return A(c);case q.TK_JSRETURN:return A(c,!0);
case q.TK_BREAK:return c.next(),{type:"stat.break"};default:p=d(c);if("="==c.curr()||","==c.curr()){for(p=[p];l(c,",");)p.push(d(c));h(c,"=");c={type:"stat.assignment",lefts:p,right:E(c)}}else{if("expr.call"!=p.type&&"expr.callMethod"!=p.type&&"expr.javascript"!=p.type)throw Error("syntax error, unexpected expr type "+p.type);c={type:"stat.expr",expr:p}}return c}}function L(d){switch(d.curr()){case q.TK_ELSE:case q.TK_ELSEIF:case q.TK_END:case q.TK_EOS:case q.TK_UNTIL:return!0;default:return 0}}function C(d){for(var c=
[];!L(d);){if(d.curr()==q.TK_RETURN||d.curr()==q.TK_JSRETURN){c.push(I(d));break}var p=I(d);p&&c.push(p)}return{type:"block",stats:c}}function z(d){h(d,"(");var p=[];if(")"!=d.curr()){do switch(c(d.curr())){case q.TK_NAME:p.push(n(d));break;case q.TK_DOTS:p.push(q.TK_DOTS);d.next();break;default:throw"<name> or `...` expected";}while(l(d,","))}var g=!1;0<p.length&&p[p.length-1]==q.TK_DOTS&&(p.pop(),g=!0);h(d,")");var e=C(d);h(d,q.TK_END);return{type:"function",args:p,varargs:g,block:e}}var G=D("./lex.js"),
N=G.lex,q=G.TK,F=G.tokens,J=[null,[6,6],[6,6],[7,7],[7,7],[7,7],[10,9],[5,4],[3,3],[3,3],[3,3],[3,3],[3,3],[3,3],[2,2],[1,1]],K=[null,"op.add","op.minus","op.mul","op.div","op.mod","op.pow","op.concat","op.equal","op.less","op.lessequal","op.notequal","op.great","op.greatequal","op.and","op.or"];e.opname=K;var M=8;e.main=function(d){var c={type:"function",args:[],varargs:!0,block:C(d)};k(d,q.TK_EOS);return c};e.parse=function(d){return e.main(N(d))}})(z.parser);(function(e){function c(d){return"const.number"==
d.type?k(d):"l.__checknumber("+g(d)+")"}function v(d){if("vararg"==d.type||"expr.call"==d.type||"expr.callMethod"==d.type)return!0}function g(d){return v(d)?"("+k(d)+")[0]":k(d)}function l(d){if(d.length&&v(d[d.length-1])){if(1==d.length)return k(d[0]);for(var c=[],e=0;e<d.length-1;e++)c.push(g(d[e]));return"["+c.join(",")+"].concat("+k(d[d.length-1])+")"}c=[];for(e=0;e<d.length;e++)c.push(g(d[e]));return"["+c.join(",")+"]"}function k(d){if(n[d.type])return n[d.type](d);throw Error("Unsupported ast type "+
d.type);}function h(d,c){return function(g){function e(g,u){if(g&&g.constructor==Array){for(var h=0;h<g.length;h++)g[h]=e(g[h],u);return g}if(g&&g.type){var l=d(g,u)||g,k=m[l.type];if(k)for(h=0;h<k.length;h++)l[k[h]]=e(l[k[h]],l);c&&(l=c(l,u)||l);return l}}return e(g)}}var n={},r,w,B;r="\n";w=function(){r+="    "};B=function(){r=r.substr(0,r.length-4)};n["function"]=function(d){return"l._f(function("+d.args.join(",")+")"+k(d.block)+")"};n.block=function(d){var c=[];w();for(var g=0;g<d.stats.length;g++)c.push(k(d.stats[g]));
B();return r+"{"+c.join("")+r+"}"};n["stat.getvaargs"]=function(d){return r+"var __VA_ARG = Array.prototype.slice.call(arguments, "+d.argCount+");"};n["stat.expr"]=function(d){return r+k(d.expr)+";"};n["stat.local"]=function(d){if(d.right){if(1==d.names.length)return r+"var "+d.names[0]+" = "+g(d.right[0])+";";for(var c=[],e=0;e<d.names.length;e++)c.push(d.names[e]+" = t["+e+"]");return r+"var t ="+l(d.right)+","+r+c.join(",")+";"}return r+"var "+d.names.join(",")+";"};n["stat.if"]=function(d){var c=
r+"if ("+g(d.cond)+")"+k(d.tblock);return d.fblock&&0<d.fblock.stats.length?1==d.fblock.stats.length&&"stat.if"==d.fblock.stats[0].type?c+"else"+k(d.fblock.stats[0]):c+"else"+k(d.fblock):c};n["stat.fornum"]=function(d){if(d.step){w();var g=r+d.varname+" = "+d.$var+";"+k(d.block)+r+d.$var+" += "+d.$step;B();return r+"var "+d.$var+" = "+c(d.from)+", "+d.$limit+" = "+c(d.to)+", "+d.$step+" = "+c(d.step)+","+d.varname+";"+r+"while (("+d.$step+">0 && "+d.$var+"<="+d.$limit+") || ("+d.$step+"<0 && "+d.$var+
">="+d.$limit+")){"+g+r+"}"}return r+"for (var "+d.varname+", "+d.$var+" = "+c(d.from)+", "+d.$limit+" = "+c(d.to)+";("+d.varname+"="+d.$var+")<="+d.$limit+";++"+d.$var+")"+k(d.block)};n["stat.forlist"]=function(d){w();var c=d.$st,g=[];g.push(r+"var t = "+c+"[0]("+c+"[1],"+c+"[2]);");for(var e=0;e<d.varnames.length;++e)g.push(r+"var "+d.varnames[e]+" = t["+e+"];");g.push(r+"if ("+d.varnames[0]+" == null) break;");g.push(r+c+"[2] = "+d.varnames[0]+";");g.push(k(d.block));B();return r+"var "+c+" = "+
l(d.explist)+";"+r+"for (;;)"+r+"{"+g.join("")+r+"}"};n["stat.while"]=function(d){return r+"while ("+g(d.cond)+")"+k(d.block)};n["stat.repeat"]=function(d){return r+"do "+k(d.block)+"while (!("+g(d.until)+"));"};n["stat.break"]=function(d){return r+"break;"};n.vararg=function(d){return"__VA_ARG"};n["stat.return"]=function(d){var c=d.nret;if(c.length&&v(c[c.length-1]))return r+"return "+l(d.nret);for(var c=[],e=0;e<d.nret.length;e++)c.push(g(d.nret[e]));return r+"return ["+c+"];"};n["stat.jsreturn"]=
function(d){return r+"return "+g(d.nret)};n["stat.assignment"]=function(d){if(1==d.lefts.length){var c=1==d.right.length?g(d.right[0]):l(d.right)+"[0]";if("expr.index"==d.lefts[0].type){var e=d.lefts[0];return r+"l.__set("+g(e.self)+", "+k(e.key)+", "+c+");"}return r+k(d.lefts[0])+" = "+c+";"}c=[];c.push(r+"var t = "+l(d.right)+";");for(var h=0;h<d.lefts.length;++h)"expr.index"==d.lefts[h].type?(e=d.lefts[h],c.push(r+"l.__set("+g(e.self)+","+k(e.key)+",t["+h+"]);")):c.push(r+k(d.lefts[h])+" = t["+
h+"];");return c.join("")};n["expr.index"]=function(d){return"l.__get("+g(d.self)+","+k(d.key)+")"};n["expr.op"]=function(d){var c,e;switch(d.op){case "op.add":c="l.__add";break;case "op.minus":c="l.__sub";break;case "op.mul":c="l.__mul";break;case "op.div":c="l.__div";break;case "op.mod":c="l.__mod";break;case "op.pow":c="l.__pow";break;case "op.concat":c="l.__concat";break;case "op.equal":c="l.__eq";break;case "op.less":c="l.__lt";break;case "op.lessequal":c="l.__le";break;case "op.notequal":c=
"l.__neq";break;case "op.great":c="l.__gt";break;case "op.greatequal":c="l.__ge";break;case "op.and":e="&&";break;case "op.or":e="||";break;default:throw Error(d.op+" is not implemented yet.");}if(e)return g(d.left)+e+g(d.right);if(c)return c+"("+g(d.left)+","+g(d.right)+")"};n["expr.uop"]=function(d){switch(d.op){case "uop.minus":return"l.__unm("+g(d.operand)+")";case "uop.not":return"!("+g(d.operand)+")";case "uop.len":return"l.__len("+g(d.operand)+")";default:throw Error(d.op+" is not implemented yet.");
}};n["expr.call"]=function(d){return"l.__call("+g(d.func)+","+l(d.args)+")"};n["expr.callMethod"]=function(d){return"l.__callMethod("+g(d.self)+","+g(d.key)+","+l(d.args)+")"};n["expr.brackets"]=function(d){return v(d.expr)?g(d.expr):"("+k(d.expr)+")"};n["expr.constructor"]=function(d){if(!d.fields.length)return"l.__newTable()";for(var c=[],e=0;e<d.fields.length;e++){var h=d.fields[e];if("field.list"==h.type)v(h.val)&&e==d.fields.length-1?c.push("[2, "+k(h.val)+"]"):c.push("[0, "+g(h.val)+"]");else if("field.rec"==
h.type)c.push("[1, "+k(h.key)+","+g(h.val)+"]");else throw Error("Invalid field type "+h.type);}return"l.__newTable(["+c.join(",")+"])"};n.variable=function(d){return d.val};n["const.string"]=function(d){return d.val?JSON.stringify(d.val):"l.ds"};n["const.number"]=function(d){return d.val?JSON.stringify(d.val):"l.d0"};n["const.boolean"]=function(d){return JSON.stringify(d.val)};n["const.nil"]=function(d){return"null"};n["expr.javascript"]=function(d){if(1!=d.args.length)throw Error("__javascript should have exactly one arguments.");
return"const.string"==d.args[0].type?"("+d.args[0].val+")":"eval("+g(d.args[0])+")"};var m={"expr.uop":["operand"],"expr.op":["left","right"],"stat.assignment":["lefts","right"],"stat.expr":["expr"],"field.list":["val"],"field.rec":["key","val"],"expr.constructor":["fields","recs","list"],"stat.if":["cond","tblock","fblock"],"stat.fornum":["from","to","step","block"],"stat.forlist":["explist","block"],"stat.while":["cond","block"],"stat.repeat":["until","block"],"expr.index":["self","key"],"expr.callMethod":["self",
"key","args"],"expr.call":["func","args"],"expr.brackets":["expr"],"stat.method":["self","key","func"],"stat.function":["left","func"],"stat.localfunction":["func"],"stat.local":["right"],"stat.return":["nret"],"function":["block"],block:["stats"]};e.traverse=h;e.phases=[];e.postphases=[];e.run=function(d){for(var c=0;c<e.phases.length;c++)d=e.phases[c](d);d=k(d);for(c=0;c<e.postphases.length;c++)d=e.postphases[c](d);return d};(function(){e.phases.push(h(function(d){switch(d.type){case "function":d.varargs&&
d.block.stats.unshift({type:"stat.getvaargs",argCount:d.args.length});d=d.block.stats;0!=d.length&&"stat.return"==d[d.length-1].type||d.push({type:"stat.return",nret:[]});break;case "block":for(var c=[],g=0;g<d.stats.length;g++){var e=d.stats[g];switch(e.type){case "stat.localfunction":c.push({type:"stat.local",names:[e.name]});c.push({type:"stat.assignment",lefts:[{type:"variable",val:e.name}],right:[e.func]});break;case "stat.function":c.push({type:"stat.assignment",lefts:[e.left],right:[e.func]});
break;case "stat.method":e.func.args.unshift("self");c.push({type:"stat.assignment",lefts:[{type:"expr.index",self:e.self,key:e.key}],right:[e.func]});break;default:c.push(d.stats[g])}}d.stats=c}}))})();(function(){e.phases.push(function(d){var c=[],g,e={},l=0;return d=h(function(d){var h;switch(d.type){case "block":h=[];break;case "function":h=d.args;break;case "stat.fornum":h=[d.varname,"$var","$limit","$step"];break;case "stat.forlist":h=d.varnames;h.push("$st");break;case "variable":if(e[d.val]){var k;
h=e[d.val];"fornum"==g.curr.type||"forlist"==g.curr.type?h[h.length-1]!=g.curr?k=h[h.length-1]:1<h.length&&(k=h[h.length-2]):k=h[h.length-1];if(k){d.val=d.val+"$"+k.id;return}}return"_ENV"==d.val?void 0:{type:"expr.index",self:{type:"variable",val:"_ENV"},key:{type:"const.string",val:d.val}}}if(h){g&&c.push(g);g={curr:d,names:h.slice(0)};for(k=0;k<h.length;k++){var m=h[k];e[m]=e[m]||[];var n=++l;h[k]=m+"$"+n;e[m].push({id:n,curr:d})}"stat.fornum"==d.type?(d.varname=h[0],d.$var=h[1],d.$limit=h[2],
d.$step=h[3]):"stat.forlist"==d.type&&(d.$st=h.pop())}},function(d){if(g&&g.curr==d){for(var h=0;h<g.names.length;h++){var k=g.names[h];e[k].pop();0==e[k].length&&delete e[k]}g=c.pop()}else if("stat.local"==d.type)for(h=0;h<d.names.length;h++){k=d.names[h];e[k]=e[k]||[];var m=e[k];if(0<m.length&&m[m.length-1]===g){var n=m[m.length-1].id=++l;d.names[h]=k+"$"+n}else n=++l,d.names[h]=k+"$"+n,m.push({id:n,curr:g.curr}),g.names.push(k)}})(d)})})();(function(){e.phases.push(function(d){var c=[];return d=
h(function(d){switch(d.type){case "function":if(0<c.length){d=c[c.length-1];for(var g=0;g<d.length;g++)d[g].has_closure=!0}c.push([]);break;case "stat.fornum":case "stat.forlist":case "stat.repeat":case "stat.while":c[c.length-1].push(d)}},function(d){switch(d.type){case "function":c.pop();break;case "stat.fornum":case "stat.forlist":if(d.has_closure){var g=d.block,g={type:"block",stats:[{type:"stat.expr",expr:{type:"expr.call",func:{type:"function",args:[d.varname],varargs:!1,block:g},args:[{type:"variable",
val:d.varname}]}}]};d.block=g}break;case "stat.repeat":case "stat.while":g=d.block,g={type:"block",stats:[{type:"stat.expr",expr:{type:"expr.call",func:{type:"function",args:[],varargs:!1,block:g},args:[]}}]},d.block=g}})(d)})})();e.sign="/*lua.js generated code*/";(function(){e.postphases.push(function(d){return"/*lua.js generated code*/return "+d+";"})})()})(z.codegen);(function(e){function c(){this._hashKey=-2;this.toString=function(){return""}}function v(c){this.stringMap={};this.array=[];this.hashMap=
{};this.metatable=null;this._hashKey=++k;if(c)for(var g=0;g<c.length;g++){var e=c[g];if(0==e[0])this.array.push(e[1]);else if(1==e[0])this.set(e[1],e[2]);else for(var l=0;l<e[1].length;l++)this.array.push(e[1][l])}}var g={_hashKey:-1,valueOf:function(){return 0},toString:function(){return"0"}};c.prototype=String.prototype;var l=new c;e.dummy0=g;e.dummyStr=l;var k=0;e.LuaTable=v;e.newHashKey=function(){return++k};v.prototype={};v.prototype.constructor=v;v.prototype.get=function(c){switch(typeof c){case "number":return this.array[c-
1];case "string":return this.stringMap[c];case "object":if(c===g)return this.array[-1];if(c===l)return this.stringMap[c];if(null===c)throw Error("table index is nil");case "function":return c._hashKey||(c._hashKey=++k),(c=this.hashMap[c._hashKey])&&c[1];default:throw Error("get with a invalid argument"+c);}};v.prototype.set=function(c,g){if(null==c)throw Error("table index is nil");if(null==g)switch(typeof c){case "number":c==this.array.length?this.array.pop():delete this.array[c-1];break;case "string":delete this.stringMap[c];
break;case "object":case "function":if(!c._hashKey)break;delete this.hashMap[c._hashKey];break;default:throw Error("set with a invalid argument"+c);}else switch(typeof c){case "number":this.array[c-1]=g;break;case "string":this.stringMap[c]=g;break;case "object":case "function":c._hashKey||(c._hashKey=++k);this.hashMap[c._hashKey]=[c,g];break;default:throw Error("set with a invalid argument"+c);}};v.prototype.length=function(){for(var c=this.array.length;0<c&&null==this.array[c-1];--c);c!=this.array.length&&
(this.array.length=c);return this.array.length};v.prototype.toString=function(){return"table "+this._hashKey}})(z.types);(function(e){function c(c){return c.substr(0,k.length)!=k?l.run(g.parse(c)):c}function v(){function g(d,c){var e=m.__getmetatable(d);return e&&e.stringMap&&e.stringMap[c]}if(!(this instanceof v))return new v;var k=new h.LuaTable;this._G=k;k.set("_G",k);k.set("_VERSION","Lua 5.2");k.set("_LUAJS","Lua.js 0.1");var m={};m.d0=n;m.ds=r;m.__getmetatable=function(d){if(!d)return null;
switch(typeof d){case "object":return d.metatable||(d instanceof h.LuaTable?null:m.jsObjMT);case "string":return m.stringMT;case "function":if(!f.__lua_function)return m.jsFuncMT;default:return null}};m._f=function(d){d.__lua_function=!0;return d};m.__get=function(d,c){var e;if(d instanceof h.LuaTable){if(e=d.get(c))return e;e=g(d,"__index");if(!e)return null}else{if("object"==typeof d||"function"==typeof d&&!d.__lua_function){"function"==typeof d&&d.__beforeBind&&(d=d.__beforeBind);e="number"==typeof c?
d[c-1]:d[c];if("function"==typeof e){var l=e.bind(d);l.__beforeBind=e;return l}if(!e&&"new"==c){var k=function(){};k.prototype=d.prototype;return function(){var d=new k;t.apply(d,arguments);return d}}return e}e=g(d,"__index");if(!e)throw Error("attempt to index a "+m.__type(d)+" value.");}return"function"==typeof e?m.__call(e,[d,c])[0]:m.__get(e,c)};m.__set=function(d,c,e){var l;if(d instanceof h.LuaTable){if(d.get(c)){d.set(c,e);return}l=g(d,"__newindex");if(!l){d.set(c,e);return}}else{if("object"==
typeof d||"function"==typeof d&&!d.__lua_function){d[c]=e;return}l=g(d,"__newindex");if(!l)throw Error("attempt to index a "+m.__type(d)+" value.");}"function"==typeof l?m.__call(l,[d,c,e]):m.__set(l,c,e)};m.__add=function(d,c){if("number"==typeof d&&"number"==typeof c)return d+c||n;var e=m.__tonumber(d),h=m.__tonumber(c);if(e&&h)return d+c||n;if(e=g(d,"__add")||g(c,"__add"))return m.__call(e,[d,c])[0];throw Error("attempt to perform arithmetic on a "+m.__type(d)+" value");};m.__sub=function(d,c){if("number"==
typeof d&&"number"==typeof c)return d-c||n;var e=m.__tonumber(d),h=m.__tonumber(c);if(e&&h)return d-c||n;if(e=g(d,"__sub")||g(c,"__sub"))return m.__call(e,[d,c])[0];throw Error("attempt to perform arithmetic on a "+m.__type(d)+" value");};m.__mul=function(d,c){if("number"==typeof d&&"number"==typeof c)return d*c||n;var e=m.__tonumber(d),h=m.__tonumber(c);if(e&&h)return d*c||n;if(e=g(d,"__mul")||g(c,"__mul"))return m.__call(e,[d,c])[0];throw Error("attempt to perform arithmetic on a "+m.__type(d)+
" value");};m.__div=function(d,c){if("number"==typeof d&&"number"==typeof c)return d/c||n;var e=m.__tonumber(d),h=m.__tonumber(c);if(e&&h)return d/c||n;if(e=g(d,"__div")||g(c,"__div"))return m.__call(e,[d,c])[0];throw Error("attempt to perform arithmetic on a "+m.__type(d)+" value");};m.__mod=function(d,c){if("number"==typeof d&&"number"==typeof c)return d%c||n;var e=m.__tonumber(d),h=m.__tonumber(c);if(e&&h)return d%c||n;if(e=g(d,"__mod")||g(c,"__mod"))return m.__call(e,[d,c])[0];throw Error("attempt to perform arithmetic on a "+
m.__type(d)+" value");};m.__pow=function(d,c){if("number"==typeof d&&"number"==typeof c)return Math.pow(d,c)||n;var e=m.__tonumber(d),h=m.__tonumber(c);if(e&&h)return Math.pow(d,c)||n;if(e=g(d,"__pow")||g(c,"__pow"))return m.__call(e,[d,c])[0];throw Error("attempt to perform arithmetic on a "+m.__type(d)+" value");};m.__unm=function(d){var c=m.__tonumber(d);if(c)return-c;if(c=g(d).__unm)return m.__call(c,[d])[0];throw Error("attempt to perform arithmetic on a "+m.__type(d)+" value");};m.__eq=function(d,
c){return!m.__neq(d,c)};m.__neq=function(d,c){if(d===c)return!1;var e=m.__type(d),h=m.__type(c);if(e!=h||"table"!=e&&"userdata"!=e)return!0;e=g(d,"__eq");h=g(c,"__eq");return e&&e==h?!m.__call(e,[d,c])[0]:!0};m.__gt=function(d,c){return m.__lt(c,d)};m.__ge=function(d,c){return m.__le(c,d)};m.__lt=function(d,c){var e=m.__type(d),h=m.__type(c);if("number"==e&&"number"==h||"string"==e&&"string"==h)return d<c;if(g(d,"__lt")||g(d,"__lt"))return!!m.__call(h1,[d,c])[0];throw Error("attempt to compare "+
m.__type(d)+" with "+m.__type(c));};m.__le=function(d,c){var e=m.__type(d),h=m.__type(c);if("number"==e&&"number"==h||"string"==e&&"string"==h)return d<=c;if(e=g(d,"__le")||g(d,"__le"))return!!m.__call(h1,[d,c])[0];if(e=g(d,"__lt")||g(d,"__lt"))return!m.__call(h1,[d,c])[0];throw Error("attempt to compare "+m.__type(d)+" with "+m.__type(c));};m.__concat=function(d,c){var e=m.__type(d),h=m.__type(c);if(!("number"!=e&&"string"!=e||"number"!=h&&"string"!=h))return""+d+c||r;if(g(d,"__concat")||g(c,"__concat"))return m.__call(h1,
[d,c])[0];throw Error("attempt to concatenate a "+m.__type(d)+" value");};m.__newTable=function(c){return new h.LuaTable(c)};m.__len=function(c){switch(typeof c){case "string":return c.length}var e=g(c,"__len");if(e)return m.__call(e,[a])[0];if(c instanceof h.LuaTable)return c.length();if("object"==typeof c&&c.length)return c.length;throw Error("attempt to get length of a "+m.__type(c)+" value");};m.__tonumber=function(c){switch(typeof c){case "number":return c;case "string":return parseInt(s)||n;
default:if(c==n)return c}return null};m.__checknumber=function(c){switch(typeof c){case "number":return c;case "string":return parseInt(s)}if(c==n)return c;throw Error("Not a number.");};m.__tostring=function(c){if(null==c)return"nil";switch(typeof c){case "number":case "boolean":return c.toString();case "string":return c;case "function":return c._hashKey=c._hashKey||h.newHashKey(),"function("+c._hashKey+")";case "object":if(c==n)return"0";if(c==r)return r;var e=g(c,"__tostring");if(e)return m.__call(e,
[c])[0];if(c.toString)return c.toString();default:return"userdata("+c+")"}};m.__type=function(c){if(null==c)return"nil";var e=typeof c;switch(e){case "number":case "boolean":case "string":case "function":return e;case "object":if(c==n)return"number";if(c==r)return r;if(c instanceof h.LuaTable)return"table";default:return"userdata"}};m.__call=function(c,e){if("function"==typeof c)return c.__lua_function?c.apply(null,e):[c.apply(null,e)];var h=g(c,"__call");if(h)return e.unshift(h),m.__call(h,e);throw Error("attempt to call a "+
m.__type(c)+" value");};m.__callMethod=function(c,e,g){g.unshift(c);return m.__call(m.__get(c,e),g)};m.__dump=function(c){if("function"!=typeof c)throw Error("bad argument #1 to `dump` (function expected, got "+m.__type(c)+")");return l.sign+"return "+c.toString()+";"};this.loadString=m.__loadString=function(d,e){d=c(d);return(new Function("_ENV","l",d))(e||k,m)};this.loadStdLib=function(){if(!e.stdlib){var c=D("fs"),g=D("path"),c=c.readFileSync(g.join(g.dirname(module.filename),"./stdlib.lua"),{encoding:"utf-8"});
e.stdlib=new Function("_ENV","l",e.compile(c))}e.stdlib(k,m)()}}var g=D("./parser.js");e.parser=g;var l=D("./codegen.js");e.codegen=l;var k=l.sign;e.compile=c;var h=D("./types.js");e.types=h;var n=h.dummy0,r=h.dummyStr;v.prototype={};e.LuaContext=e.newContext=v})(z.index);z.index.stdlib=function(e,c){return c._f(function(){Array.prototype.slice.call(arguments,0);c.__set(e,"assert",c._f(function(g,l){g||c.__call(c.__get(e,"error"),[l||"Assertion failed!"]);return[]}));c.__set(e,"collectgarbage",c._f(function(){return[]}));
var v;v=c._f(function(g){c.__call(c.__get(e,"error"),["Not implemented"]);return[]});c.__set(e,"dofile",v);c.__set(e,"error",function(c){if("string"==typeof c)throw Error(c);throw c;});c.__set(e,"getmetatable",function(c){return c&&c.metatable});c.__set(e,"ipairs",c._f(function(e){return[c._f(function(e,g){return c.__ge(g,c.__len(e))?[]:[c.__add(g,1),c.__get(e,c.__add(g,1))]}),e,c.d0]}));c.__set(e,"loadString",function(e,l){return c.__loadString(e,l)});c.__set(e,"load",c._f(function(g,l,k,h){if(c.__eq(c.__call(c.__get(e,
"type"),[g])[0],"function")){l=c.__newTable();for(g=[g];;){k=g[0](g[1],g[2])[0];if(null==k)break;g[2]=k;c.__call(c.__get(c.__get(e,"table"),"insert"),[c.__get(e,"chunk"),k])}g=c.__call(c.__get(c.__get(e,"table"),"concat"),[l])[0]}return c.__call(c.__get(e,"loadString"),[g,h])}));c.__set(e,"loadfile",v);c.__set(e,"next",v);c.__set(e,"pairs",v);c.__set(e,"pcall",c._f(function(e){var l=Array.prototype.slice.call(arguments,1);try{var k=c.__call(e,l);k.unshift(!0);return k}catch(h){return[!1,h]}}));c.__set(e,
"print",c._f(function(){for(var g=Array.prototype.slice.call(arguments,0),g=c.__newTable([[2,g]]),l,k=1,h=c.__checknumber(c.__len(g));(l=k)<=h;++k)c.__set(g,l,c.__call(c.__get(e,"tostring"),[c.__get(g,l)])[0]);c.__call(c.__get(c.__get(e,"io"),"write"),c.__call(c.__get(c.__get(e,"table"),"concat"),[g," "]));c.__call(c.__get(c.__get(e,"io"),"write"),["\n"]);return[]}));c.__set(e,"rawequal",function(c,e){return c===e});c.__set(e,"rawget",function(e,l){var k=c.__type(e);if("table"!=k)throw Error("rawget called with type "+
k);return e.get(l)});c.__set(e,"rawlen",function(e){var l=c.__type(e);if("table"!=l)throw Error("rawlen called with type "+l);return e.length()});c.__set(e,"rawset",function(e,l,k){var h=c.__type(e);if("table"!=h)throw Error("rawget called with type "+h);e.set(l,k);return e});c.__set(e,"select",function(c){return"#"==c?arguments.length:arguments[c]});c.__set(e,"setmetatable",function(c,e){if("object"!=typeof c)throw Error("Cannot set metatable to non-object values.");c.metatable=e});c.__set(e,"tonumber",
c.__tonumber);c.__set(e,"tostring",c.__tostring);c.__set(e,"type",c.__type);c.__set(e,"xpcall",function(e,l){var k=Array.prototype.slice.call(arguments,2);try{return c.__call(e,k)}catch(h){return c.__call(l,[h])}});c.__set(e,"package",c.__newTable());c.__set(c.__get(e,"package"),"loaded",c.__newTable());c.__set(c.__get(e,"package"),"preload",c.__newTable());c.__set(e,"require",c._f(function(g){var l=c.__get(c.__get(c.__get(e,"package"),"loaded"),g);if(l)return[l];for(var k,h,l=c.__call(c.__get(e,
"ipairs"),[c.__get(c.__get(e,"package"),"searchers")]);;){var n=l[0](l[1],l[2]),r=n[0],n=n[1];if(null==r)break;l[2]=r;n=c.__call(n,[g]);k=n[0];h=n[1];if(k)break}k=c.__call(k,[g,h])[0];c.__set(c.__get(c.__get(e,"package"),"loaded"),g,c.__get(c.__get(c.__get(e,"package"),"loaded"),g)||k);return[c.__get(c.__get(c.__get(e,"package"),"loaded"),g)]}));c.__set(e,"string",c.__newTable());c.stringMT=c.__get(e,"string");c.__set(c.__get(e,"string"),"byte",c._f(function(e,l,k){if("string"!=typeof e&&(e=c.__tostring(e),
e==c.ds))return[];l=l||1;k=k||l;0>l?l=e.length+l:l--;0>k&&(k=e.length+k+1);for(var h=[];l<k;++l){var n=e.charCodeAt(l);n&&h.push(n)}return h}));c.__set(c.__get(e,"string"),"dump",c.__dump);c.__set(c.__get(e,"string"),"find",function(c,e,k,h){if(h)return c.indexOf(e,k&&k-1)+1;throw Error("Not implemented.");});c.__set(c.__get(e,"string"),"len",function(e){"string"!=typeof e&&e!=c.ds&&(e=c.__tostring(e));return e==c.ds?0:e.length});c.__set(c.__get(e,"string"),"lower",function(e){"string"!=typeof e&&
e!=c.ds&&(e=c.__tostring(e));return e==c.ds?e:e.toLowerCase()});c.__set(c.__get(e,"string"),"upper",function(e){"string"!=typeof e&&e!=c.ds&&(e=c.__tostring(e));return e==c.ds?e:e.toUpperCase()});c.__set(c.__get(e,"string"),"rep",function(c,e,k){return k?Array(e).join(c+k)+c:Array(e+1).join(c)});c.__set(c.__get(e,"string"),"reverse",function(e){"string"!=typeof e&&e!=c.ds&&(e=c.__tostring(e));return e==c.ds?e:e.split("").reverse().join("")});c.__set(c.__get(e,"string"),"sub",function(e,l,k){"string"!=
typeof e&&e!=c.ds&&(e=c.__tostring(e));if(e==c.ds)return[e];k=k||e.length;0>l?l=e.length+l:l--;0>k&&(k=e.length+k+1);return e.substring(e,l,k)});c.__set(e,"table",c.__newTable());c.__set(c.__get(e,"table"),"concat",function(c,e,k,h){c=c.array;k&&(c=h?c.slice(k-1,h-1):c.slice(k-1));return c.join(e||"")});c.__set(c.__get(e,"table"),"insert",function(c,e,k){e?c.array.splice(e-1,0,k):c.array.push(k)});c.__set(c.__get(e,"table"),"pack",c._f(function(){var e=Array.prototype.slice.call(arguments,0);return[c.__newTable([[2,
e]])]}));c.__set(e,"pack",c.__get(c.__get(e,"table"),"pack"));c.__set(c.__get(e,"table"),"remove",c._f(function(c,e){return e?c.array.splice(e-1,1):[c.array.pop()]}));c.__set(c.__get(e,"table"),"sort",function(e,l){l?e.array.sort(function(){return l(a,b)[0]?-1:l(b,a)[0]?1:0}):e.array.sort(function(e,g){return c.__lt(e,g)?-1:c.__lt(g,e)?1:0})});c.__set(c.__get(e,"table"),"unpack",c._f(function(c){return c.array}));c.__set(e,"math",c.__newTable());c.__set(c.__get(e,"math"),"abs",Math.abs);c.__set(c.__get(e,
"math"),"acos",Math.acos);c.__set(c.__get(e,"math"),"asin",Math.asin);c.__set(c.__get(e,"math"),"atan",Math.atan);c.__set(c.__get(e,"math"),"atan2",Math.atan2);c.__set(c.__get(e,"math"),"ceil",Math.ceil);c.__set(c.__get(e,"math"),"cos",Math.cos);c.__set(c.__get(e,"math"),"cosh",Math.cosh);c.__set(c.__get(e,"math"),"deg",Math.deg);c.__set(c.__get(e,"math"),"exp",Math.exp);c.__set(c.__get(e,"math"),"floor",Math.floor);c.__set(c.__get(e,"math"),"pow",Math.pow);c.__set(c.__get(e,"math"),"sin",Math.sin);
c.__set(c.__get(e,"math"),"sinh",Math.sinh);c.__set(c.__get(e,"math"),"sqrt",Math.sqrt);c.__set(c.__get(e,"math"),"tan",Math.tan);c.__set(c.__get(e,"math"),"tanh",Math.tanh);c.__set(c.__get(e,"math"),"pi",Math.PI);c.__set(c.__get(e,"math"),"log",function(c,e){return e?Math.log(c)/Math.log(e):Math.log(c)});c.__set(c.__get(e,"math"),"max",function(){return Math.max.apply(null,arguments)});c.__set(c.__get(e,"math"),"min",function(c){return Math.min.apply(null,arguments)});c.__set(c.__get(e,"math"),"rad",
function(c){return[c*Math.PI/180]});c.__set(c.__get(e,"math"),"random",function(c,e){return c?e?[Math.floor(Math.random()*(e-c+1))+c]:[Math.floor(Math.random()*c)+1]:[Math.random()]});c.__set(e,"bit32",c.__newTable());c.__set(c.__get(e,"bit32"),"arshift",function(c,e){return c<<e});c.__set(c.__get(e,"bit32"),"band",function(c){for(var e=1;e<arguments.length;e++)c&=arguments[e];return c});c.__set(c.__get(e,"bit32"),"bnot",function(c){return~c});c.__set(c.__get(e,"bit32"),"bor",function(c){for(var e=
1;e<arguments.length;e++)c|=arguments[e];return c});c.__set(c.__get(e,"bit32"),"btest",function(c){for(var e=1;e<arguments.length;e++)c&=arguments[e];return 0!=c});c.__set(c.__get(e,"bit32"),"bxor",function(c){for(var e=1;e<arguments.length;e++)c^=arguments[e];return 0!=c});c.__set(e,"io",c.__newTable());c.__set(c.__get(e,"io"),"write",function(c){"\n"!=c&&console.log(c)});c.__set(c.__get(e,"io"),"flush",c._f(function(){return[]}));c.__set(e,"os",c.__newTable());c.__set(c.__get(e,"os"),"clock",function(){var c=
Date.now();return function(){return(Date.now()-c)/1E3}}());c.__set(c.__get(e,"os"),"difftime",c._f(function(e,l){return[c.__sub(e,l)]}));c.__set(c.__get(e,"os"),"time",function(){return Date.now()/1E3});return[]})};window.luajs=z.index;(function(){function e(c,e){var g=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");g.addEventListener("readystatechange",function(){if(4==g.readyState){if(200!=g.status&&0!=g.status)throw Error("HTTP "+g.status+": "+c);console.info("Loaded: ",
c);e(g.responseText)}});g.open("GET",c,!0);g.send()}function c(l,k){k=k||0;if(!(k>=l.length)){var h=l[k];h.code?(g.loadString(h.code)("embedded"),c(l,k+1)):e(h.src,function(e){g.loadString(e)(h.src);c(l,k+1)})}}function v(){for(var e=window.document.getElementsByTagName("script"),g=[],h=0;h<e.length;h++){var n=e[h];if("text/lua"==n.type||"application/x-lua"==n.type)n.src?g.push({src:n.src}):g.push({code:n.innerHTML})}c(g)}var g=luajs.newContext();g.loadStdLib();g._G.metatable=new luajs.types.LuaTable([[1,
"__index",window]]);window.addEventListener?window.addEventListener("DOMContentLoaded",v,!1):window.attachEvent("onload",v)})()})();
