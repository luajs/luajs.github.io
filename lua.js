(function(){function C(m){return x[/\.\/(\w*)\.js/.exec(m)[1]]}var x={lex:{},parser:{},codegen:{},types:{},index:{}};(function(m){function p(a){return B.test(a)}function v(a){return"\n"==a||"\r"==a}function l(a,b,e){var h=0,c=a();if("["!=c&&"]"!=c)throw"Lexical internal error!";e&&e(c);for(b();"="==a();)b(),e&&e(a()),++h;return a()==c?h:-h-1}function g(a,b){var e=a();b();v(a())&&a()!=e&&b()}function q(a,b,e){function h(a){c.push(a)}var c=[];b();for(v(a())&&g(a,b);;){var f=a();switch(f){case null:throw"unfinished long string/comment";
case "]":if(l(a,b,h)==e)return b(),c.splice(-e-1,e+1),c.join("");break;case "\n":case "\r":g(a,b);h("\n");break;default:h(f),b()}}}function d(a,b){for(;;)switch(a()){case "\n":case "\r":case " ":case "\f":case "\t":case "\v":b();break;case "-":b();if("-"!=a())return"-";b();var e=a();if("["==e){var h=l(a,b);if(0<=h){q(a,b,h);break}}for(;e&&"\n"!=e&&"\r"!=e;)b(),e=a();break;case "[":h=l(a,b);if(0<=h)return{id:f.TK_STRING,val:q(a,b,h)};if(-1==h)return"[";throw"invalid long string delimiter";case "=":b();
if("="!=a())return"=";b();return f.TK_EQ;case "<":b();if("="!=a())return"<";b();return f.TK_LE;case ">":b();if("="!=a())return">";b();return f.TK_GE;case "~":b();if("="!=a())return"~";b();return f.TK_NE;case ":":b();if(":"!=a())return":";b(ls);return f.TK_DBCOLON;case '"':case "'":var e=f.TK_STRING,h=a,d=b,t=[],w=h();d();for(var y=void 0;(y=h())!=w;)switch(y){case null:throw"unfinished string";case "\n":case "\r":throw"unfinished string";case "\\":d();y=h();switch(y){case "b":t.push("\b");d();break;
case "f":t.push("\f");d();break;case "n":t.push("\n");d();break;case "r":t.push("\r");d();break;case "t":t.push("\t");d();break;case "v":t.push("\v");d();break;case "\n":case "\r":t.push("\n");g();break;case "\\":case '"':case "'":t.push(y);d();break;case null:throw"unfinished string";case "z":for(d();lisspace(h());)d();break;case "x":throw"esacpe for char code not supported in lua.js yet.";default:if(!r.test(y))throw"invalid escape sequence"+y;throw"esacpe for char code not supported in lua.js yet.";
}break;default:t.push(y),d()}d();h=t.join("");return{id:e,val:h};case ".":b();if("."==a())return b(),"."==a()?(b(),f.TK_DOTS):f.TK_CONCAT;e=a();if(!r.test(e))return".";case "0":case "1":case "2":case "3":case "4":case "5":case "6":case "7":case "8":case "9":e=f.TK_NUMBER;h=a;d=b;t=h();d();if("0"!=t||"x"!=h()&&"X"!=h()){t=[t];for(w=h();r.test(w)||"."==w;)t.push(w),d(),w=h();h=parseFloat(t.join(""))}else throw d(),Error("Hexadecimal numeric not supported in lua.js yet.");return{id:e,val:h};case null:return f.TK_EOS;
default:e=a();if(c.test(e)){e=a;h=b;for(d=[];p(e());)d.push(e()),h();e=d.join("");return(h=n[e])?h:{id:f.TK_NAME,val:e}}e=a();b();return e}}function u(a){function b(){return h<a.length?a.charAt(h):null}function e(){h<a.length&&++h}var h=0;return function(){return d(b,e)}}m.tokens="<eof> and break do else elseif end false for function goto if in local nil not or repeat return then true until while .. ... == >= <= ~= :: <--orgion-eof> <number> <name> <string> __javascript".split(" ");var n={and:1,"break":2,
"do":3,"else":4,elseif:5,end:6,"false":7,"for":8,"function":9,"goto":10,"if":11,"in":12,local:13,nil:14,not:15,or:16,repeat:17,"return":18,then:19,"true":20,until:21,"while":22,__javascript:34,__js:34},f={TK_EOS:0,TK_AND:1,TK_BREAK:2,TK_DO:3,TK_ELSE:4,TK_ELSEIF:5,TK_END:6,TK_FALSE:7,TK_FOR:8,TK_FUNCTION:9,TK_GOTO:10,TK_IF:11,TK_IN:12,TK_LOCAL:13,TK_NIL:14,TK_NOT:15,TK_OR:16,TK_REPEAT:17,TK_RETURN:18,TK_THEN:19,TK_TRUE:20,TK_UNTIL:21,TK_WHILE:22,TK_CONCAT:23,TK_DOTS:24,TK_EQ:25,TK_GE:26,TK_LE:27,TK_NE:28,
TK_DBCOLON:29,TK_NUMBER:31,TK_NAME:32,TK_STRING:33,TK_JAVASCRIPT:34};m.TK=f;var c=/^[A-Za-z\_]$/,r=/^[0-9]$/,B=/^[0-9A-Za-z\_]$/;m.generator=u;m.lex=function(a){var b=u(a),e=b(),h=b();return{curr:function(){return e},lookAhead:function(){return h},next:function(){e=h;h=b()}}}})(x.lex);(function(m){function p(a){switch(typeof a){case "string":case "number":return a;case "object":return a.id}}function v(a){return"number"==typeof a?D[a]:"object"==typeof a?D[a.id]:a}function l(a){q(a,k.TK_NAME);var e=
a.curr().val;a.next();return{type:"variable",val:e}}function g(a,e){if(p(a.curr())==e)return a.next(),!0}function q(a,e){if(p(a.curr())!=e)throw Error("symbol "+v(e)+" expected!");}function d(a,e){q(a,e);a.next()}function u(a){q(a,k.TK_NAME);var e=a.curr().val;a.next();return e}function n(a){return{type:"const.string",val:u(a)}}function f(a){q(a,k.TK_STRING);var e=a.curr().val;a.next();return{type:"const.string",val:e}}function c(a){a.next();var b=e(a,0);d(a,"]");return b}function r(a){switch(p(a.curr())){case "(":a.next();
if(")"==a.curr())return a.next(),[];var e=h(a);d(a,")");return e;case "{":return[t(a)];case k.TK_STRING:return[f(a)];default:throw Error("function arguments expected, got "+v(a.curr()));}}function B(a){var b;a:switch(b=p(a.curr()),b){case "(":a.next();b=e(a,0);d(a,")");b={type:"expr.brackets",expr:b};break a;case k.TK_NAME:b=l(a);break a;case k.TK_JAVASCRIPT:a.next();b={type:"expr.javascript",args:r(a)};break a;default:throw Error("unexpected symbol "+(D[b]||b));}for(;;)switch(p(a.curr())){case ".":a.next();
var h=n(a);b={type:"expr.index",self:b,key:h};break;case "[":h=c(a);b={type:"expr.index",self:b,key:h};break;case ":":a.next();var h=n(a),f=r(a);b={type:"expr.callMethod",self:b,key:h,args:f};break;case "(":case "{":case k.TK_STRING:f=r(a);b={type:"expr.call",func:b,args:f};break;default:return b}}function a(a){switch(a.curr()){case "+":return 1;case "-":return 2;case "*":return 3;case "/":return 4;case "%":return 5;case "^":return 6;case k.TK_CONCAT:return 7;case k.TK_EQ:return 8;case "<":return 9;
case k.TK_LE:return 10;case k.TK_NE:return 11;case ">":return 12;case k.TK_GE:return 13;case k.TK_AND:return 14;case k.TK_OR:return 15}}function b(a){switch(p(a.curr())){case k.TK_NUMBER:var b=a.curr().val;a.next();return{type:"const.number",val:b};case k.TK_STRING:return f(a);case k.TK_NIL:return a.next(),{type:"const.nil"};case k.TK_TRUE:return a.next(),{type:"const.boolean",val:!0};case k.TK_FALSE:return a.next(),{type:"const.boolean",val:!1};case k.TK_DOTS:return a.next(),{type:"vararg"};case "{":return t(a);
case k.TK_FUNCTION:return a.next(),E(a);default:return B(a)}}function e(A,h){var c,f;a:{switch(A.curr()){case k.TK_NOT:f="uop.not";break a;case "-":f="uop.minus";break a;case "#":f="uop.len";break a}f=void 0}f?(A.next(),c=e(A,I),c={type:"expr.uop",op:f,operand:c}):c=b(A);for(f=a(A);f&&G[f][0]>h;){A.next();var d=e(A,G[f][1]);c={type:"expr.op",op:H[f],left:c,right:d};f=a(A)}return c}function h(a){var b=[];for(b.push(e(a,0));g(a,",");)b.push(e(a,0));return b}function F(a){var b;b=p(a.curr())==k.TK_NAME?
n(a):c(a);d(a,"=");return{type:"field.rec",key:b,val:e(a,0)}}function t(a){d(a,"{");var b=[];do{if("}"==a.curr())break;var h;a:{h=a;var c=h.curr();switch(p(c)){case k.TK_NAME:h="="!=h.lookAhead()?{type:"field.list",val:e(h,0)}:F(h);break a;case "[":h=F(h);break a;default:h={type:"field.list",val:e(h,0)}}}h&&b.push(h)}while(g(a,",")||g(a,";"));d(a,"}");return{type:"expr.constructor",fields:b}}function w(a){switch(a.curr()){case ";":a.next();break;case k.TK_IF:var b={type:"stat.if"},c=b;a.next();var f=
c;f.cond=e(a,0);d(a,k.TK_THEN);for(f.tblock=z(a);g(a,k.TK_ELSEIF);){c.fblock={type:"block",stats:[{type:"stat.if"}]};var c=c.fblock.stats[0],f=a,w=c;w.cond=e(f,0);d(f,k.TK_THEN);w.tblock=z(f)}g(a,k.TK_ELSE)&&(c.fblock=z(a));d(a,k.TK_END);return b;case k.TK_WHILE:return a.next(),b=e(a,0),d(a,k.TK_DO),c=z(a),d(a,k.TK_END),{type:"stat.while",cond:b,block:c};case k.TK_DO:return a.next(),b=z(a),d(a,k.TK_END),b;case k.TK_FOR:a.next();c=u(a);switch(a.curr()){case "=":a.next();f=e(a,0);d(a,",");w=e(a,0);
g(a,",")&&(b=e(a,0));b={type:"stat.fornum",varname:c,from:f,to:w,step:b};break;case ",":case k.TK_IN:for(b=[c];g(a,",");)b.push(u(a));d(a,k.TK_IN);b={type:"stat.forlist",varnames:b,explist:h(a)};break;default:throw"`=` or `in` expected";}d(a,k.TK_DO);b.block=z(a);d(a,k.TK_END);return b;case k.TK_REPEAT:return a.next(),b=z(a),d(a,k.TK_UNTIL),{type:"stat.repeat",until:e(a,0),block:b};case k.TK_FUNCTION:a.next();for(b=l(a);g(a,".");)c=n(a),b={type:"expr.index",self:b,key:c};g(a,":")?(c=n(a),b={type:"stat.method",
self:b,key:c}):b={type:"stat.function",left:b};b.func=E(a);return b;case k.TK_LOCAL:a.next();if(g(a,k.TK_FUNCTION))return{type:"stat.localfunction",name:u(a),func:E(a)};b=[];do b.push(u(a));while(g(a,","));g(a,"=")&&(c=h(a));return{type:"stat.local",names:b,right:c};case k.TK_RETURN:b={type:"stat.return",nret:[]};a.next();y(a)||";"==a.curr()||(b.nret=h(a));for(;g(a,";"););return b;case k.TK_BREAK:return a.next(),{type:"stat.break"};default:b=B(a);if("="==a.curr()||","==a.curr()){for(b=[b];g(a,",");)b.push(B(a));
d(a,"=");a={type:"stat.assignment",lefts:b,right:h(a)}}else{if("expr.call"!=b.type&&"expr.callMethod"!=b.type&&"expr.javascript"!=b.type)throw Error("syntax error, unexpected expr type "+b.type);a={type:"stat.expr",expr:b}}return a}}function y(a){switch(a.curr()){case k.TK_ELSE:case k.TK_ELSEIF:case k.TK_END:case k.TK_EOS:case k.TK_UNTIL:return!0;default:return 0}}function z(a){for(var b=[];!y(a);){if(a.curr()==k.TK_RETURN){b.push(w(a));break}var e=w(a);e&&b.push(e)}return{type:"block",stats:b}}function E(a){d(a,
"(");var b=[];if(")"!=a.curr()){do switch(p(a.curr())){case k.TK_NAME:b.push(u(a));break;case k.TK_DOTS:b.push(k.TK_DOTS);a.next();break;default:throw"<name> or `...` expected";}while(g(a,","))}var e=!1;0<b.length&&b[b.length-1]==k.TK_DOTS&&(b.pop(),e=!0);d(a,")");var h=z(a);d(a,k.TK_END);return{type:"function",args:b,varargs:e,block:h}}var x=C("./lex.js"),J=x.lex,k=x.TK,D=x.tokens,G=[null,[6,6],[6,6],[7,7],[7,7],[7,7],[10,9],[5,4],[3,3],[3,3],[3,3],[3,3],[3,3],[3,3],[2,2],[1,1]],H=[null,"op.add",
"op.minus","op.mul","op.div","op.mod","op.pow","op.concat","op.equal","op.less","op.lessequal","op.notequal","op.great","op.greatequal","op.and","op.or"];m.opname=H;var I=8;m.main=function(a){var b={type:"function",args:[],varargs:!0,block:z(a)};q(a,k.TK_EOS);return b};m.parse=function(a){return m.main(J(a))}})(x.parser);(function(m){function p(a){return"const.number"==a.type?d(a):"l.__checknumber("+g(a)+")"}function v(a){if("vararg"==a.type||"expr.call"==a.type||"expr.callMethod"==a.type)return!0}
function l(a){return a.length?v(a[a.length-1]):!1}function g(a){return v(a)?"("+d(a)+")[0]":d(a)}function q(a){if(l(a)){if(1==a.length)return d(a[0]);for(var b=[],e=0;e<a.length-1;e++)b.push(g(a[e]));return"["+b.join(",")+"].concat("+d(a[a.length-1])+")"}b=[];for(e=0;e<a.length;e++)b.push(g(a[e]));return"["+b.join(",")+"]"}function d(a){if(n[a.type])return n[a.type](a);throw Error("Unsupported ast type "+a.type);}function u(a,b){return function(e){function h(e,c){if(e&&e.constructor==Array){for(var f=
0;f<e.length;f++)e[f]=h(e[f],c);return e}if(e&&e.type){var d=a(e,c)||e,g=B[d.type];if(g)for(f=0;f<g.length;f++)d[g[f]]=h(d[g[f]],d);b&&(d=b(d,c)||d);return d}}return h(e)}}var n={},f,c,r;f="\n";c=function(){f+="    "};r=function(){f=f.substr(0,f.length-4)};n["function"]=function(a){return"function("+a.args.join(",")+")"+d(a.block)};n.block=function(a){var b=[];c();for(var e=0;e<a.stats.length;e++)b.push(d(a.stats[e]));r();return f+"{"+b.join("")+f+"}"};n["stat.getvaargs"]=function(a){return f+"var __VA_ARG = Array.prototype.slice.call(arguments, "+
a.argCount+");"};n["stat.expr"]=function(a){return f+d(a.expr)+";"};n["stat.local"]=function(a){if(a.right){if(1==a.names.length)return f+"var "+a.names[0]+" = "+g(a.right[0])+";";for(var b=[],e=0;e<a.names.length;e++)b.push(a.names[e]+" = t["+e+"]");return f+"var t ="+q(a.right)+","+f+b.join(",")+";"}return f+"var "+a.names.join(",")+";"};n["stat.if"]=function(a){var b=f+"if ("+g(a.cond)+")"+d(a.tblock);return a.fblock&&0<a.fblock.stats.length?1==a.fblock.stats.length&&"stat.if"==a.fblock.stats[0].type?
b+"else"+d(a.fblock.stats[0]):b+"else"+d(a.fblock):b};n["stat.fornum"]=function(a){if(a.step){c();var b=f+a.varname+" = "+a.$var+";"+d(a.block)+f+a.$var+" += "+a.$step;r();return f+"var "+a.$var+" = "+p(a.from)+", "+a.$limit+" = "+p(a.to)+", "+a.$step+" = "+p(a.step)+","+a.varname+";"+f+"while (("+a.$step+">0 && "+a.$var+"<="+a.$limit+") || ("+a.$step+"<0 && "+a.$var+">="+a.$limit+")){"+b+f+"}"}return f+"for (var "+a.varname+", "+a.$var+" = "+p(a.from)+", "+a.$limit+" = "+p(a.to)+";("+a.varname+"="+
a.$var+")<="+a.$limit+";++"+a.$var+")"+d(a.block)};n["stat.forlist"]=function(a){c();var b=a.$st,e=[];e.push(f+"var t = "+b+"[0]("+b+"[1],"+b+"[2]);");for(var h=0;h<a.varnames.length;++h)e.push(f+"var "+a.varnames[h]+" = t["+h+"];");e.push(f+"if ("+a.varnames[0]+" == null) break;");e.push(f+b+"[2] = "+a.varnames[0]+";");e.push(d(a.block));r();return f+"var "+b+" = "+q(a.explist)+";"+f+"for (;;)"+f+"{"+e.join("")+f+"}"};n["stat.while"]=function(a){return f+"while ("+g(a.cond)+")"+d(a.block)};n["stat.repeat"]=
function(a){return f+"do "+d(a.block)+"while (!("+g(a.until)+"));"};n["stat.break"]=function(a){return f+"break;"};n.vararg=function(a){return"__VA_ARG"};n["stat.return"]=function(a){if(l(a.nret))return f+"return "+q(a.nret);for(var b=[],e=0;e<a.nret.length;e++)b.push(g(a.nret[e]));return f+"return ["+b+"];"};n["stat.assignment"]=function(a){if(1==a.lefts.length){var b=1==a.right.length?g(a.right[0]):q(a.right)+"[0]";if("expr.index"==a.lefts[0].type){var e=a.lefts[0];return f+"l.__set("+g(e.self)+
", "+d(e.key)+", "+b+");"}return f+d(a.lefts[0])+" = "+b+";"}b=[];b.push(f+"var t = "+q(a.right)+";");for(var c=0;c<a.lefts.length;++c)"expr.index"==a.lefts[c].type?(e=a.lefts[c],b.push(f+"l.__set("+g(e.self)+","+d(e.key)+",t["+c+"]);")):b.push(f+d(a.lefts[c])+" = t["+c+"];");return b.join("")};n["expr.index"]=function(a){return"l.__get("+g(a.self)+","+d(a.key)+")"};n["expr.op"]=function(a){var b,e;switch(a.op){case "op.add":b="l.__add";break;case "op.minus":b="l.__minus";break;case "op.mul":b="l.__mul";
break;case "op.div":b="l.__div";break;case "op.mod":e="%";break;case "op.pow":b="Math.pow";break;case "op.concat":b="l.__concat";break;case "op.equal":e="===";break;case "op.less":b="l.__lt";break;case "op.lessequal":b="l.__le";break;case "op.notequal":e="!==";break;case "op.great":b="l.__gt";break;case "op.greatequal":b="l.__ge";break;case "op.and":e="&&";break;case "op.or":e="||";break;default:throw Error(a.op+" is not implemented yet.");}if(e)return g(a.left)+e+g(a.right);if(b)return b+"("+g(a.left)+
","+g(a.right)+")"};n["expr.uop"]=function(a){switch(a.op){case "uop.minus":return"-"+g(a.operand);case "uop.not":return"!l.__toboolean("+g(a.operand)+")";case "uop.len":return"l.__len("+g(a.operand)+")";default:throw Error(a.op+" is not implemented yet.");}};n["expr.call"]=function(a){var b=g(a.func);if(l(a.args))return b+".apply(null, "+q(a.args)+")";for(var e=[],c=0;c<a.args.length;c++)e.push(g(a.args[c]));return b+"("+e.join(",")+")"};n["expr.callMethod"]=function(a){return"l.__callMethod("+g(a.self)+
","+g(a.key)+","+q(a.args)+")"};n["expr.brackets"]=function(a){return v(a.expr)?g(a.expr):"("+d(a.expr)+")"};n["expr.constructor"]=function(a){if(!a.fields.length)return"l.__newTable()";for(var b=[],e=0;e<a.fields.length;e++){var c=a.fields[e];if("field.list"==c.type)b.push("[0, "+d(c.val)+"]");else if("field.rec"==c.type)b.push("[1, "+d(c.key)+","+d(c.val)+"]");else throw Error("Invalid field type "+c.type);}return"l.__newTable(["+b.join(",")+"])"};n.variable=function(a){return a.val};n["const.string"]=
function(a){return a.val?JSON.stringify(a.val):"l.ds"};n["const.number"]=function(a){return a.val?JSON.stringify(a.val):"l.d0"};n["const.boolean"]=function(a){return JSON.stringify(a.val)};n["const.nil"]=function(a){return"null"};n["expr.javascript"]=function(a){if(1!=a.args.length)throw Error("__javascript should have exactly one arguments.");return"const.string"==a.args[0].type?"("+a.args[0].val+")":"eval("+g(a.args[0])+")"};var B={"expr.uop":["operand"],"expr.op":["left","right"],"stat.assignment":["lefts",
"right"],"stat.expr":["expr"],"field.list":["val"],"field.rec":["key","val"],"expr.constructor":["fields","recs","list"],"stat.if":["cond","tblock","fblock"],"stat.fornum":["from","to","step","block"],"stat.forlist":["explist","block"],"stat.while":["cond","block"],"stat.repeat":["until","block"],"expr.index":["self","key"],"expr.callMethod":["self","key","args"],"expr.call":["func","args"],"expr.brackets":["expr"],"stat.method":["self","key","func"],"stat.function":["left","func"],"stat.localfunction":["func"],
"stat.local":["right"],"stat.return":["nret"],"function":["block"],block:["stats"]};m.traverse=u;m.phases=[];m.postphases=[];m.run=function(a){for(var b=0;b<m.phases.length;b++)a=m.phases[b](a);a=d(a);for(b=0;b<m.postphases.length;b++)a=m.postphases[b](a);return a};(function(){m.phases.push(u(function(a){switch(a.type){case "function":a.varargs&&a.block.stats.unshift({type:"stat.getvaargs",argCount:a.args.length});break;case "block":for(var b=[],e=0;e<a.stats.length;e++){var c=a.stats[e];switch(c.type){case "stat.localfunction":b.push({type:"stat.local",
names:[c.name]});b.push({type:"stat.assignment",lefts:[{type:"variable",val:c.name}],right:[c.func]});break;case "stat.function":b.push({type:"stat.assignment",lefts:[c.left],right:[c.func]});break;case "stat.method":c.func.args.unshift("self");b.push({type:"stat.assignment",lefts:[{type:"expr.index",self:c.self,key:c.key}],right:[c.func]});break;default:b.push(a.stats[e])}}a.stats=b}}))})();(function(){m.phases.push(function(a){var b=[],e,c={},f=0;return a=u(function(a){var d;switch(a.type){case "block":d=
[];break;case "function":d=a.args;break;case "stat.fornum":d=[a.varname,"$var","$limit","$step"];break;case "stat.forlist":d=a.varnames;d.push("$st");break;case "variable":if(c[a.val]){var g;d=c[a.val];"fornum"==e.curr.type||"forlist"==e.curr.type?d[d.length-1]!=e.curr?g=d[d.length-1]:1<d.length&&(g=d[d.length-2]):g=d[d.length-1];if(g){a.val=a.val+"$"+g.id;return}}return"_ENV"==a.val?void 0:{type:"expr.index",self:{type:"variable",val:"_ENV"},key:{type:"const.string",val:a.val}}}if(d){e&&b.push(e);
e={curr:a,names:d.slice(0)};for(g=0;g<d.length;g++){var r=d[g];c[r]=c[r]||[];var l=++f;d[g]=r+"$"+l;c[r].push({id:l,curr:a})}"stat.fornum"==a.type?(a.varname=d[0],a.$var=d[1],a.$limit=d[2],a.$step=d[3]):"stat.forlist"==a.type&&(a.$st=d.pop())}},function(a){if(e&&e.curr==a){for(var d=0;d<e.names.length;d++){var g=e.names[d];c[g].pop();0==c[g].length&&delete c[g]}e=b.pop()}else if("stat.local"==a.type)for(d=0;d<a.names.length;d++){g=a.names[d];c[g]=c[g]||[];var r=c[g];if(0<r.length&&r[r.length-1]===
e){var l=r[r.length-1].id=++f;a.names[d]=g+"$"+l}else l=++f,a.names[d]=g+"$"+l,r.push({id:l,curr:e.curr}),e.names.push(g)}})(a)})})();(function(){m.postphases.push(function(a){return"(function(_ENV, l){return "+a+";})"})})();m.sign="/*lua.js generated code*/";(function(){m.postphases.push(function(a){return"/*lua.js generated code*/"+a})})()})(x.codegen);(function(m){function p(l){this.stringMap={};this.array=[];this.hashMap={};this.metatable=null;this._hashKey=++v;if(l)for(var g=0;g<l.length;g++){var m=
l[g];"0"==m[0]?this.array.push(m[1]):this.set(m[1],m[2])}}var v=0;m.LuaTable=p;p.prototype={};p.prototype.constructor=p;p.prototype.get=function(l){if(null==l)throw Error("table index is nil");switch(typeof l){case "number":return this.array[l-1];case "string":return this.stringMap[l];case "object":case "function":return l._hashKey||(l._hashKey=++v),this.hashMap[l._hashKey][1];default:throw Error("get with a invalid argument"+l);}};p.prototype.set=function(l,g){if(null==l)throw Error("table index is nil");
if(null==g)switch(typeof l){case "number":l==this.array.length?this.array.pop():delete this.array[l-1];break;case "string":delete this.stringMap[l];break;case "object":case "function":if(!l._hashKey)break;delete this.hashMap[l._hashKey];break;default:throw Error("set with a invalid argument"+l);}else switch(typeof l){case "number":this.array[l-1]=g;break;case "string":this.stringMap[l]=g;break;case "object":case "function":l._hashKey||(l._hashKey=++v);this.hashMap[l._hashKey]=[l,g];break;default:throw Error("set with a invalid argument"+
l);}};p.prototype.length=function(){for(var l=this.array.length;0<l&&null==this.array[l-1];--l);l!=this.array.length&&(this.array.length=l);return this.array.length};p.prototype.toString=function(){return"table "+this._hashKey}})(x.types);(function(m){function p(c){return c.substr(0,g.length)!=g?l.run(v.parse(c)):c}var v=C("./parser.js");m.parser=v;var l=C("./codegen.js");m.codegen=l;var g=l.sign;m.compile=p;var q={valueOf:function(){return 0},toString:function(){return"0"}},d={toString:function(){return""}},
u=C("./types.js");m.types=u;var n=new u.LuaTable;m._G=n;var f={};m.helpers=f;f.d0=q;f.ds=d;f.__get=function(c,d){if(null==c)throw Error("attempt to index a nil value.");return c.get(d)};f.__set=function(c,d,f){return c.set(d,f)};f.__add=function(c,d){if("number"==typeof c&&"number"==typeof d)return c+d||q;throw Error("Some feature not implemented yet.");};f.__mul=function(c,d){if("number"==typeof c&&"number"==typeof d)return c*d||q;throw Error("Some feature not implemented yet.");};f.__minus=function(c,
d){if("number"==typeof c&&"number"==typeof d)return c-d||q;throw Error("Some feature not implemented yet.");};f.__div=function(c,d){if("number"==typeof c&&"number"==typeof d)return c/d||q;throw Error("Some feature not implemented yet.");};f.__gt=function(c,d){if("number"==typeof c&&"number"==typeof d||"string"==typeof c&&"string"==typeof d)return d<c;throw Error("Some feature not implemented yet.");};f.__ge=function(c,d){if("number"==typeof c&&"number"==typeof d||"string"==typeof c&&"string"==typeof d)return d<=
c;throw Error("Some feature not implemented yet.");};f.__lt=function(c,d){if("number"==typeof c&&"number"==typeof d||"string"==typeof c&&"string"==typeof d)return c<d;throw Error("Some feature not implemented yet.");};f.__le=function(c,d){if("number"==typeof c&&"number"==typeof d||"string"==typeof c&&"string"==typeof d)return c<=d;throw Error("Some feature not implemented yet.");};f.__concat=function(c,f){if("number"!=typeof c&&"string"!=typeof c||"number"!=typeof f&&"string"!=typeof f)throw Error("Some feature not implemented yet.");
return""+c+f||d};f.__newTable=function(c){return new u.LuaTable(c)};f.__callMethod=function(c,d,g){g.unshift(c);f.__get(c,d).apply(null,g)};f.__len=function(c){switch(typeof c){case "string":return c.length;case "object":if(c.constructor==u.LuaTable)return c.length();default:throw Error("Cannot get length of type "+typeof c);}};f.__tonumber=function(c){switch(typeof c){case "number":return c;case "string":try{return parseInt(s)}catch(d){}}return null};f.__checknumber=function(c){switch(typeof c){case "number":return c;
case "string":try{return parseInt(s)}catch(d){}}if(c==q)return c;throw Error("Not a number.");};f.__tostring=function(c){if(null==c)return"nil";switch(typeof c){case "number":case "boolean":return c.toString();case "string":return c;case "function":return"function: ";case "object":if(c==q)return"0";if(c==d)return d;if(c.toString)return c.toString();default:return"jsvalue("+c+")"}};m.loadString=function(c){c=p(c);return eval(c)(n,f)}})(x.index);window.luajs=x.index})();
