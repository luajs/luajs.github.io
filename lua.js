(function(){function A(n){return q[/\.\/(\w*)\.js/.exec(n)[1]]}var q={lex:{},parser:{},codegen:{},types:{},index:{}};(function(n){function p(a){return q.test(a)}function w(a){return"\n"==a||"\r"==a}function f(a,d,h){var b=0,c=a();if("["!=c&&"]"!=c)throw"Lexical internal error!";h&&h(c);for(d();"="==a();)d(),h&&h(a()),++b;return a()==c?b:-b-1}function g(a,d){var h=a();d();w(a())&&a()!=h&&d()}function t(a,d,h){function b(a){c.push(a)}var c=[];d();for(w(a())&&g(a,d);;){var e=a();switch(e){case null:throw"unfinished long string/comment";
case "]":if(f(a,d,b)==h)return d(),c.splice(-h-1,h+1),c.join("");break;case "\n":case "\r":g(a,d);b("\n");break;default:b(e),d()}}}function e(a,d){for(;;)switch(a()){case "\n":case "\r":case " ":case "\f":case "\t":case "\v":d();break;case "-":d();if("-"!=a())return"-";d();var h=a();if("["==h){var k=f(a,d);if(0<=k){t(a,d,k);break}}for(;h&&"\n"!=h&&"\r"!=h;)d(),h=a();break;case "[":k=f(a,d);if(0<=k)return{id:c.TK_STRING,val:t(a,d,k)};if(-1==k)return"[";throw"invalid long string delimiter";case "=":d();
if("="!=a())return"=";d();return c.TK_EQ;case "<":d();if("="!=a())return"<";d();return c.TK_LE;case ">":d();if("="!=a())return">";d();return c.TK_GE;case "~":d();if("="!=a())return"~";d();return c.TK_NE;case ":":d();if(":"!=a())return":";d(ls);return c.TK_DBCOLON;case '"':case "'":var h=c.TK_STRING,k=a,e=d,r=[],u=k();e();for(var v=void 0;(v=k())!=u;)switch(v){case null:throw"unfinished string";case "\n":case "\r":throw"unfinished string";case "\\":e();v=k();switch(v){case "b":r.push("\b");e();break;
case "f":r.push("\f");e();break;case "n":r.push("\n");e();break;case "r":r.push("\r");e();break;case "t":r.push("\t");e();break;case "v":r.push("\v");e();break;case "\n":case "\r":r.push("\n");g();break;case "\\":case '"':case "'":r.push(v);e();break;case null:throw"unfinished string";case "z":for(e();lisspace(k());)e();break;case "x":throw"esacpe for char code not supported in lua.js yet.";default:if(!z.test(v))throw"invalid escape sequence"+v;throw"esacpe for char code not supported in lua.js yet.";
}break;default:r.push(v),e()}e();k=r.join("");return{id:h,val:k};case ".":d();if("."==a())return d(),"."==a()?(d(),c.TK_DOTS):c.TK_CONCAT;h=a();if(!z.test(h))return".";case "0":case "1":case "2":case "3":case "4":case "5":case "6":case "7":case "8":case "9":h=c.TK_NUMBER;k=a;e=d;r=k();e();if("0"!=r||"x"!=k()&&"X"!=k()){r=[r];for(u=k();z.test(u)||"."==u;)r.push(u),e(),u=k();k=parseFloat(r.join(""))}else throw e(),"Hexadecimal numeric not supported in lua.js yet.";return{id:h,val:k};case null:return c.TK_EOS;
default:h=a();if(x.test(h)){h=a;k=d;for(e=[];p(h());)e.push(h()),k();h=e.join("");return(k=b[h])?k:{id:c.TK_NAME,val:h}}h=a();d();return h}}function l(a){function b(){return c<a.length?a.charAt(c):null}function h(){c<a.length&&++c}var c=0;return function(){return e(b,h)}}n.tokens="<eof> and break do else elseif end false for function goto if in local nil not or repeat return then true until while .. ... == >= <= ~= :: <--orgion-eof> <number> <name> <string> __javascript".split(" ");var b={and:1,"break":2,
"do":3,"else":4,elseif:5,end:6,"false":7,"for":8,"function":9,"goto":10,"if":11,"in":12,local:13,nil:14,not:15,or:16,repeat:17,"return":18,then:19,"true":20,until:21,"while":22,__javascript:34,__js:34},c={TK_EOS:0,TK_AND:1,TK_BREAK:2,TK_DO:3,TK_ELSE:4,TK_ELSEIF:5,TK_END:6,TK_FALSE:7,TK_FOR:8,TK_FUNCTION:9,TK_GOTO:10,TK_IF:11,TK_IN:12,TK_LOCAL:13,TK_NIL:14,TK_NOT:15,TK_OR:16,TK_REPEAT:17,TK_RETURN:18,TK_THEN:19,TK_TRUE:20,TK_UNTIL:21,TK_WHILE:22,TK_CONCAT:23,TK_DOTS:24,TK_EQ:25,TK_GE:26,TK_LE:27,TK_NE:28,
TK_DBCOLON:29,TK_NUMBER:31,TK_NAME:32,TK_STRING:33,TK_JAVSCRIPT:34};n.TK=c;var x=/^[A-Za-z\_]$/,z=/^[0-9]$/,q=/^[0-9A-Za-z\_]$/;n.generator=l;n.lex=function(a){var b=l(a),h=b(),c=b();return{curr:function(){return h},lookAhead:function(){return c},next:function(){h=c;c=b()}}}})(q.lex);(function(n){function p(a){switch(typeof a){case "string":case "number":return a;case "object":return a.id}}function w(a){return"number"==typeof a?B[a]:"object"==typeof a?B[a.id]:a}function f(a){t(a,m.TK_NAME);var b=
a.curr().val;a.next();return{type:"variable",val:b}}function g(a,b){if(p(a.curr())==b)return a.next(),!0}function t(a,b){if(p(a.curr())!=b)throw Error("symbol "+w(b)+" expected!");}function e(a,b){t(a,b);a.next()}function l(a){t(a,m.TK_NAME);var b=a.curr().val;a.next();return b}function b(a){return{type:"const.string",val:l(a)}}function c(a){t(a,m.TK_STRING);var b=a.curr().val;a.next();return{type:"const.string",val:b}}function x(a){a.next();var b=h(a,0);e(a,"]");return b}function z(a){switch(p(a.curr())){case "(":a.next();
if(")"==a.curr())return a.next(),[];var b=k(a);e(a,")");return b;case "{":return[r(a)];case m.TK_STRING:return[c(a)];default:throw Error("function arguments expected, got "+w(a.curr()));}}function q(a){var d;a:switch(d=p(a.curr()),d){case "(":a.next();d=h(a,0);e(a,")");d={type:"expr.brackets",expr:d};break a;case m.TK_NAME:d=f(a);break a;case m.TK_JAVSCRIPT:a.next();d={type:"expr.javascript",args:z(a)};break a;default:throw Error("unexpected symbol "+(B[d]||d));}for(;;)switch(p(a.curr())){case ".":a.next();
var c=b(a);d={type:"expr.index",self:d,key:c};break;case "[":c=x(a);d={type:"expr.index",self:d,key:c};break;case ":":a.next();var c=b(a),k=z(a);d={type:"expr.callMethod",self:d,key:c,args:k};break;case "(":case "{":case m.TK_STRING:k=z(a);d={type:"expr.call",func:d,args:k};break;default:return d}}function a(a){switch(a.curr()){case "+":return 1;case "-":return 2;case "*":return 3;case "/":return 4;case "%":return 5;case "^":return 6;case m.TK_CONCAT:return 7;case m.TK_EQ:return 8;case "<":return 9;
case m.TK_LE:return 10;case m.TK_NE:return 11;case ">":return 12;case m.TK_GE:return 13;case m.TK_AND:return 14;case m.TK_OR:return 15}}function d(a){switch(p(a.curr())){case m.TK_NUMBER:var b=a.curr().val;a.next();return{type:"const.number",val:b};case m.TK_STRING:return c(a);case m.TK_NIL:return a.next(),{type:"const.nil"};case m.TK_TRUE:return a.next(),{type:"const.boolean",val:!0};case m.TK_FALSE:return a.next(),{type:"const.boolean",val:!1};case m.TK_DOTS:return a.next(),{type:"vararg"};case "{":return r(a);
case m.TK_FUNCTION:return a.next(),C(a);default:return q(a)}}function h(b,c){var k,e;a:{switch(b.curr()){case m.TK_NOT:e="uop.not";break a;case "-":e="uop.minus";break a;case "#":e="uop.len";break a}e=void 0}e?(b.next(),k=h(b,H),k={type:"expr.uop",op:e,operand:k}):k=d(b);for(e=a(b);e&&F[e][0]>c;){b.next();var g=h(b,F[e][1]);k={type:"expr.op",op:G[e],left:k,right:g};e=a(b)}return k}function k(a){var b=[];for(b.push(h(a,0));g(a,",");)b.push(h(a,0));return b}function E(a){var d;d=p(a.curr())==m.TK_NAME?
b(a):x(a);e(a,"=");return{type:"field.rec",key:d,val:h(a,0)}}function r(a){e(a,"{");var b=[];do{if("}"==a.curr())break;var d;a:{d=a;var c=d.curr();switch(p(c)){case m.TK_NAME:d="="!=d.lookAhead()?{type:"field.list",val:h(d,0)}:E(d);break a;case "[":d=E(d);break a;default:d={type:"field.list",val:h(d,0)}}}d&&b.push(d)}while(g(a,",")||g(a,";"));e(a,"}");return{type:"expr.constructor",fields:b}}function u(a){switch(a.curr()){case ";":a.next();break;case m.TK_IF:var d={type:"stat.if"},c=d;a.next();var u=
c;u.cond=h(a,0);e(a,m.TK_THEN);for(u.tblock=y(a);g(a,m.TK_ELSEIF);){c.fblock={type:"block",stats:[{type:"stat.if"}]};var c=c.fblock.stats[0],u=a,r=c;r.cond=h(u,0);e(u,m.TK_THEN);r.tblock=y(u)}g(a,m.TK_ELSE)&&(c.fblock=y(a));e(a,m.TK_END);return d;case m.TK_WHILE:return a.next(),d=h(a,0),e(a,m.TK_DO),c=y(a),e(a,m.TK_END),{type:"stat.while",cond:d,block:c};case m.TK_DO:return a.next(),d=y(a),e(a,m.TK_END),d;case m.TK_FOR:a.next();c=l(a);switch(a.curr()){case "=":a.next();u=h(a,0);e(a,",");r=h(a,0);
g(a,",")&&(d=h(a,0));d={type:"stat.fornum",varname:c,from:u,to:r,step:d};break;case ",":case m.TK_IN:for(d=[c];g(a,",");)d.push(l(a));e(a,m.TK_IN);d={type:"stat.forlist",varnames:d,explist:k(a)};break;default:throw"`=` or `in` expected";}e(a,m.TK_DO);d.block=y(a);e(a,m.TK_END);return d;case m.TK_REPEAT:return a.next(),d=y(a),e(a,m.TK_UNTIL),{type:"stat.repeat",until:h(a,0),block:d};case m.TK_FUNCTION:a.next();for(d=f(a);g(a,".");)c=b(a),d={type:"expr.index",self:d,key:c};g(a,":")?(c=b(a),d={type:"stat.method",
self:d,key:c}):d={type:"stat.function",left:d};d.func=C(a);return d;case m.TK_LOCAL:a.next();if(g(a,m.TK_FUNCTION))return{type:"stat.localfunction",name:l(a),func:C(a)};d=[];do d.push(l(a));while(g(a,","));g(a,"=")&&(c=k(a));return{type:"stat.local",names:d,right:c};case m.TK_RETURN:d={type:"stat.return",nret:[]};a.next();v(a)||";"==a.curr()||(d.nret=k(a));for(;g(a,";"););return d;case m.TK_BREAK:return a.next(),{type:"stat.break"};default:d=q(a);if("="==a.curr()||","==a.curr()){for(d=[d];g(a,",");)d.push(q(a));
e(a,"=");a={type:"stat.assignment",lefts:d,right:k(a)}}else{if("expr.call"!=d.type&&"expr.callMethod"!=d.type)throw"syntax error";a={type:"stat.expr",expr:d}}return a}}function v(a){switch(a.curr()){case m.TK_ELSE:case m.TK_ELSEIF:case m.TK_END:case m.TK_EOS:case m.TK_UNTIL:return!0;default:return 0}}function y(a){for(var d=[];!v(a);){if(a.curr()==m.TK_RETURN){d.push(u(a));break}var b=u(a);b&&d.push(b)}return{type:"block",stats:d}}function C(a){e(a,"(");var d=[];if(")"!=a.curr()){do switch(p(a.curr())){case m.TK_NAME:d.push(l(a));
break;case m.TK_DOTS:d.push(m.TK_DOTS);a.next();break;default:throw"<name> or `...` expected";}while(g(a,","))}var b=!1;0<d.length&&d[d.length-1]==m.TK_DOTS&&(d.pop(),b=!0);e(a,")");var c=y(a);e(a,m.TK_END);return{type:"function",args:d,varargs:b,block:c}}var D=A("./lex.js"),I=D.lex,m=D.TK,B=D.tokens,F=[null,[6,6],[6,6],[7,7],[7,7],[7,7],[10,9],[5,4],[3,3],[3,3],[3,3],[3,3],[3,3],[3,3],[2,2],[1,1]],G=[null,"op.add","op.minus","op.mul","op.div","op.mod","op.pow","op.concat","op.equal","op.less","op.lessequal",
"op.notequal","op.great","op.greatequal","op.and","op.or"];n.opname=G;var H=8;n.main=function(a){var d={type:"function",args:[],varargs:!0,block:y(a)};t(a,m.TK_EOS);return d};n.parse=function(a){return n.main(I(a))}})(q.parser);(function(n){function p(a){return"const.number"==a.type?e(a):"l.__checknumber("+g(a)+")"}function w(a){if("vararg"==a.type||"expr.call"==a.type||"expr.callMethod"==a.type)return!0}function f(a){return a.length?w(a[a.length-1]):!1}function g(a){return w(a)?"("+e(a)+")[0]":e(a)}
function t(a){if(f(a)){if(1==a.length)return e(a[0]);for(var d=[],b=0;b<a.length-1;b++)d.push(g(a[b]));return"["+d.join(",")+"].concat("+e(a[a.length-1])+")"}d=[];for(b=0;b<a.length;b++)d.push(g(a[b]));return"["+d.join(",")+"]"}function e(a){if(b[a.type])return b[a.type](a);throw Error("Unsupported ast type "+a.type);}function l(a,d){return function(b){function c(b,h){if(b&&b.constructor==Array){for(var e=0;e<b.length;e++)b[e]=c(b[e],h);return b}if(b&&b.type){var g=a(b,h)||b,f=A[g.type];if(f)for(e=
0;e<f.length;e++)g[f[e]]=c(g[f[e]],g);d&&(g=d(g,h)||g);return g}}return c(b)}}var b={},c,x,q;c="\n";x=function(){c+="    "};q=function(){c=c.substr(0,c.length-4)};b["function"]=function(a){return"function("+a.args.join(",")+")"+e(a.block)};b.block=function(a){var d=[];x();for(var b=0;b<a.stats.length;b++)d.push(e(a.stats[b]));q();return c+"{"+d.join("")+c+"}"};b["stat.getvaargs"]=function(a){return c+"var __VA_ARG = Array.prototype.slice.call(arguments, "+a.argCount+");"};b["stat.expr"]=function(a){return c+
e(a.expr)+";"};b["stat.local"]=function(a){if(a.right){if(1==a.names.length)return c+"var "+a.names[0]+" = "+g(a.right[0])+";";for(var d=[],b=0;b<a.names.length;b++)d.push(a.names[b]+" = t["+b+"]");return c+"var t ="+t(a.right)+","+c+d.join(",")+";"}return c+"var "+a.names.join(",")+";"};b["stat.if"]=function(a){var d=c+"if (l.__toboolean("+e(a.cond)+"))"+e(a.tblock);return a.fblock&&0<a.fblock.stats.length?1==a.fblock.stats.length&&"stat.if"==a.fblock.stats[0].type?d+"else"+e(a.fblock.stats[0]):
d+"else"+e(a.fblock):d};b["stat.fornum"]=function(a){if(a.step){x();var d=c+a.varname+" = "+a.$var+";"+e(a.block)+c+a.$var+" += "+a.$step;q();return c+"var "+a.$var+" = "+p(a.from)+", "+a.$limit+" = "+p(a.to)+", "+a.$step+" = "+p(a.step)+","+a.varname+";"+c+"while (("+a.$step+">0 && "+a.$var+"<="+a.$limit+") || ("+a.$step+"<0 && "+a.$var+">="+a.$limit+")){"+d+c+"}"}return c+"for (var "+a.varname+", "+a.$var+" = "+p(a.from)+", "+a.$limit+" = "+p(a.to)+";("+a.varname+"="+a.$var+")<="+a.$limit+";++"+
a.$var+")"+e(a.block)};b["stat.forlist"]=function(a){x();var d=a.$st,b=[];b.push(c+"var t = "+d+"[0]("+d+"[1],"+d+"[2]);");for(var k=0;k<a.varnames.length;++k)b.push(c+"var "+a.varnames[k]+" = t["+k+"];");b.push(c+"if ("+a.varnames[0]+" == null) break;");b.push(c+d+"[2] = "+a.varnames[0]+";");b.push(e(a.block));q();return c+"var "+d+" = "+t(a.explist)+";"+c+"for (;;)"+c+"{"+b.join("")+c+"}"};b["stat.while"]=function(a){return c+"while (l.__toboolean("+g(a.cond)+"))"+e(a.block)};b["stat.repeat"]=function(a){return c+
"do "+e(a.block)+"while (!l.__toboolean("+g(a.until)+"));"};b["stat.break"]=function(a){return c+"break;"};b.vararg=function(a){return"__VA_ARG"};b["stat.return"]=function(a){if(f(a.nret))return c+"return "+t(a.nret);for(var b=[],e=0;e<a.nret.length;e++)b.push(g(a.nret[e]));return c+"return ["+b+"];"};b["stat.assignment"]=function(a){if(1==a.lefts.length){var b=1==a.right.length?g(a.right[0]):t(a.right)+"[0]";if("expr.index"==a.lefts[0].type){var h=a.lefts[0];return c+"l.__set("+g(h.self)+", "+e(h.key)+
", "+b+");"}return c+e(a.lefts[0])+" = "+b+";"}b=[];b.push(c+"var t = "+t(a.right)+";");for(var k=0;k<a.lefts.length;++k)"expr.index"==a.lefts[k].type?(h=a.lefts[k],b.push(c+"l.__set("+g(h.self)+","+e(h.key)+",t["+k+"]);")):b.push(c+e(a.lefts[k])+" = t["+k+"];");return b.join("")};b["expr.index"]=function(a){return"l.__get("+g(a.self)+","+e(a.key)+")"};b["expr.op"]=function(a){var b,c;switch(a.op){case "op.add":b="l.__add";break;case "op.minus":b="l.__minus";break;case "op.mul":b="l.__mul";break;
case "op.div":b="l.__div";break;case "op.mod":c="%";break;case "op.pow":b="Math.pow";break;case "op.concat":b="l.__concat";break;case "op.equal":c="===";break;case "op.less":b="l.__lt";break;case "op.lessequal":b="l.__le";break;case "op.notequal":c="!==";break;case "op.great":b="l.__gt";break;case "op.greatequal":b="l.__ge";break;case "op.and":b="l.__and";break;case "op.or":b="l.__or";break;default:throw Error(a.op+" is not implemented yet.");}if(c)return g(a.left)+c+g(a.right);if(b)return b+"("+
g(a.left)+","+g(a.right)+")"};b["expr.uop"]=function(a){switch(a.op){case "uop.minus":return"-"+g(a.operand);case "uop.not":return"!l.__toboolean("+g(a.operand)+")";case "uip.len":return"l.__len("+g(a.operand)+")";default:throw Error(a.op+" is not implemented yet.");}};b["expr.call"]=function(a){var b=g(a.func);if(f(a.args))return b+".apply(null, "+t(a.args)+")";for(var c=[],e=0;e<a.args.length;e++)c.push(g(a.args[e]));return b+"("+c.join(",")+")"};b["expr.callMethod"]=function(a){return"l.__callMethod("+
g(a.self)+","+g(a.key)+","+t(a.args)+")"};b["expr.brackets"]=function(a){return w(a.expr)?g(a.expr):"("+e(a.expr)+")"};b["expr.constructor"]=function(a){if(!a.fields.length)return"l.__newTable()";for(var b=[],c=0;c<a.fields.length;c++){var k=a.fields[c];if("field.list"==k.type)b.push("[0, "+e(k.val)+"]");else if("field.rec"==k.type)b.push("[1, "+e(k.key)+","+e(k.val)+"]");else throw Error("Invalid field type "+k.type);}return"l.__newTable(["+b.join(",")+"])"};b.variable=function(a){return a.val};
b["const.string"]=function(a){return JSON.stringify(a.val)};b["const.number"]=function(a){return JSON.stringify(a.val)};b["const.boolean"]=function(a){return JSON.stringify(a.val)};b["expr.javascript"]=function(a){if(1!=a.args.length)throw Error("__javascript should have exactly one arguments.");return"const.string"==a.args[0].type?"("+a.args[0].val+")":"eval("+g(a.args[0])+")"};var A={"expr.uop":["operand"],"expr.op":["left","right"],"stat.assignment":["lefts","right"],"stat.expr":["expr"],"field.list":["val"],
"field.rec":["key","val"],"expr.constructor":["fields","recs","list"],"stat.if":["cond","tblock","fblock"],"stat.fornum":["from","to","step","block"],"stat.forlist":["explist","block"],"stat.while":["cond","block"],"stat.repeat":["until","block"],"expr.index":["self","key"],"expr.callMethod":["self","key","args"],"expr.call":["func","args"],"expr.brackets":["expr"],"stat.method":["self","key","func"],"stat.function":["left","func"],"stat.localfunction":["func"],"stat.local":["right"],"stat.return":["nret"],
"function":["block"],block:["stats"]};n.traverse=l;n.phases=[];n.postphases=[];n.run=function(a){for(var b=0;b<n.phases.length;b++)a=n.phases[b](a);a=e(a);for(b=0;b<n.postphases.length;b++)a=n.postphases[b](a);return a};(function(){n.phases.push(l(function(a){switch(a.type){case "function":a.varargs&&a.block.stats.unshift({type:"stat.getvaargs",argCount:a.args.length});break;case "block":for(var b=[],c=0;c<a.stats.length;c++){var e=a.stats[c];switch(e.type){case "stat.localfunction":b.push({type:"stat.local",
names:[e.name]});b.push({type:"stat.assignment",lefts:[{type:"variable",val:e.name}],right:[e.func]});break;case "stat.function":b.push({type:"stat.assignment",lefts:[e.left],right:[e.func]});break;case "stat.method":e.func.args.unshift("self");b.push({type:"stat.assignment",lefts:[{type:"expr.index",self:e.self,key:e.key}],right:[e.func]});break;default:b.push(a.stats[c])}}a.stats=b}}))})();(function(){n.phases.push(function(a){var b=[],c,e={},g=0;return a=l(function(a){var f;switch(a.type){case "block":f=
[];break;case "function":f=a.args;break;case "stat.fornum":f=[a.varname,"$var","$limit","$step"];break;case "stat.forlist":f=a.varnames;f.push("$st");break;case "variable":if(e[a.val]){var l;f=e[a.val];"fornum"==c.curr.type||"forlist"==c.curr.type?f[f.length-1]!=c.curr?l=f[f.length-1]:1<f.length&&(l=f[f.length-2]):l=f[f.length-1];if(l){a.val=a.val+"$"+l.id;return}}return"_ENV"==a.val?void 0:{type:"expr.index",self:{type:"variable",val:"_ENV"},key:{type:"const.string",val:a.val}}}if(f){c&&b.push(c);
c={curr:a,names:f.slice(0)};for(l=0;l<f.length;l++){var n=f[l];e[n]=e[n]||[];var p=++g;f[l]=n+"$"+p;e[n].push({id:p,curr:a})}"stat.fornum"==a.type?(a.varname=f[0],a.$var=f[1],a.$limit=f[2],a.$step=f[3]):"stat.forlist"==a.type&&(a.$st=f.pop())}},function(a){if(c&&c.curr==a){for(var f=0;f<c.names.length;f++){var l=c.names[f];e[l].pop();0==e[l].length&&delete e[l]}c=b.pop()}else if("stat.local"==a.type)for(f=0;f<a.names.length;f++){l=a.names[f];e[l]=e[l]||[];var n=e[l];if(0<n.length&&n[n.length-1]===
c){var p=n[n.length-1].id=++g;a.names[f]=l+"$"+p}else p=++g,a.names[f]=l+"$"+p,n.push({id:p,curr:c.curr}),c.names.push(l)}})(a)})})();(function(){n.postphases.push(function(a){return"(function(_ENV, l){return "+a+";})"})})();n.sign="/*lua.js generated code*/";(function(){n.postphases.push(function(a){return"/*lua.js generated code*/"+a})})()})(q.codegen);(function(n){function p(f){this.stringMap={};this.array=[];this.hashMap={};this.metatable=null;this._hashKey=++q;if(f)for(var g=0;g<f.length;g++){var n=
f[g];"0"==n[0]?this.array.push(n[1]):this.set(n[1],n[2])}}var q=0;n.LuaTable=p;p.prototype={};p.prototype.constructor=p;p.prototype.get=function(f){if(null==f)throw Error("table index is nil");switch(typeof f){case "number":return this.array[f-1];case "string":return this.stringMap[f];case "object":case "function":return f._hashKey||(f._hashKey=++q),this.hashMap[f._hashKey][1];default:throw Error("get with a invalid argument"+f);}};p.prototype.set=function(f,g){if(null==f)throw Error("table index is nil");
if(null==g)switch(typeof f){case "number":f==this.array.length?this.array.pop():delete this.array[f-1];break;case "string":delete this.stringMap[f];break;case "object":case "function":if(!f._hashKey)break;delete this.hashMap[f._hashKey];break;default:throw Error("set with a invalid argument"+f);}else switch(typeof f){case "number":this.array[f-1]=g;break;case "string":this.stringMap[f]=g;break;case "object":case "function":f._hashKey||(f._hashKey=++q);this.hashMap[f._hashKey]=[f,g];break;default:throw Error("set with a invalid argument"+
f);}};p.prototype.length=function(){for(var f=this.array.length;0<f&&null==this.array[f];--f);f!=this.array.length&&(this.array.length=f);return this.array.length};p.prototype.toString=function(){return"table "+this._hashKey}})(q.types);(function(n){function p(b){return b.substr(0,g.length)!=g?f.run(q.parse(b)):b}var q=A("./parser.js");n.parser=q;var f=A("./codegen.js");n.codegen=f;var g=f.sign;n.compile=p;var t=A("./types.js");n.types=t;var e=new t.LuaTable;n._G=e;var l={};n.helpers=l;l.__get=function(b,
c){return b.get(c)};l.__set=function(b,c,e){return b.set(c,e)};l.__add=function(b,c){if("number"==typeof b&&"number"==typeof c)return b+c;throw"Some feature not implemented yet.";};l.__mul=function(b,c){if("number"==typeof b&&"number"==typeof c)return b*c;throw"Some feature not implemented yet.";};l.__minus=function(b,c){if("number"==typeof b&&"number"==typeof c)return b-c;throw"Some feature not implemented yet.";};l.__div=function(b,c){if("number"==typeof b&&"number"==typeof c)return b/c;throw"Some feature not implemented yet.";
};l.__gt=function(b,c){if("number"==typeof b&&"number"==typeof c||"string"==typeof b&&"string"==typeof c)return c<b;throw"Some feature not implemented yet.";};l.__ge=function(b,c){if("number"==typeof b&&"number"==typeof c||"string"==typeof b&&"string"==typeof c)return c<=b;throw"Some feature not implemented yet.";};l.__lt=function(b,c){if("number"==typeof b&&"number"==typeof c||"string"==typeof b&&"string"==typeof c)return b<c;throw"Some feature not implemented yet.";};l.__le=function(b,c){if("number"==
typeof b&&"number"==typeof c||"string"==typeof b&&"string"==typeof c)return b<=c;throw"Some feature not implemented yet.";};l.__concat=function(b,c){if("number"!=typeof b&&"string"!=typeof b||"number"!=typeof c&&"string"!=typeof c)throw"Some feature not implemented yet.";return""+b+c};l.__and=function(b,c){return l.__toboolean(b)?c:b};l.__or=function(b,c){return l.__toboolean(b)?b:c};l.__newTable=function(b){return new t.LuaTable(b)};l.__callMethod=function(b,c,e){e.unshift(b);l.__get(b,c).apply(null,
e)};l.__toboolean=function(b){switch(typeof b){case "object":return null!=b;case "string":case "function":case "number":return!0;case "boolean":return b;case "undefined":return!1;default:throw Error("Unsupported js type "+typeof b);}};l.__len=function(b){switch(typeof b){case "string":return b.length;case "object":if(b.constructor==t.LuaTable)return b.length();default:throw Error("Cannot get length of type "+typeof b);}};l.__tonumber=function(b){switch(typeof b){case "number":return b;case "string":try{return parseInt(s)}catch(c){}}return null};
l.__checknumber=function(b){switch(typeof b){case "number":return b;case "string":try{return parseInt(s)}catch(c){}}throw Error("Not a number.");};l.__tostring=function(b){if(null==b)return"nil";switch(typeof b){case "number":return b.toString();case "string":return b;case "function":return"function: ";case "object":if(b.constructor==t.LuaTable)return b.toString();default:return"jsvalue("+b+")"}};n.loadString=function(b){b=p(b);return eval(b)(e,l)}})(q.index);window.luajs=q.index})();
