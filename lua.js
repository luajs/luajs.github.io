(function(){function B(d){return x[/\.\/(\w*)\.js/.exec(d)[1]]}var x={lex:{},parser:{},codegen:{},types:{},index:{}};(function(d){function c(c){return e.test(c)}function r(e){return"\n"==e||"\r"==e}function f(e,c,f){var d=0,k=e();if("["!=k&&"]"!=k)throw"Lexical internal error!";f&&f(k);for(c();"="==e();)c(),f&&f(e()),++d;return e()==k?d:-d-1}function k(e,c){var f=e();c();r(e())&&e()!=f&&c()}function h(e,c,q){function d(e){h.push(e)}var h=[];c();for(r(e())&&k(e,c);;){var u=e();switch(u){case null:throw"unfinished long string/comment";
case "]":if(f(e,c,d)==q)return c(),h.splice(-q-1,q+1),h.join("");break;case "\n":case "\r":k(e,c);d("\n");break;default:d(u),c()}}}function l(e,g){for(;;)switch(e()){case "\n":case "\r":case " ":case "\f":case "\t":case "\v":g();break;case "-":g();if("-"!=e())return"-";g();var q=e();if("["==q){var d=f(e,g);if(0<=d){h(e,g,d);break}}for(;q&&"\n"!=q&&"\r"!=q;)g(),q=e();break;case "[":d=f(e,g);if(0<=d)return{id:v.TK_STRING,val:h(e,g,d)};if(-1==d)return"[";throw"invalid long string delimiter";case "=":g();
if("="!=e())return"=";g();return v.TK_EQ;case "<":g();if("="!=e())return"<";g();return v.TK_LE;case ">":g();if("="!=e())return">";g();return v.TK_GE;case "~":g();if("="!=e())return"~";g();return v.TK_NE;case ":":g();if(":"!=e())return":";g(ls);return v.TK_DBCOLON;case '"':case "'":var q=v.TK_STRING,d=e,t=g,u=[],l=d();t();for(var m=void 0;(m=d())!=l;)switch(m){case null:throw"unfinished string";case "\n":case "\r":throw"unfinished string";case "\\":t();m=d();switch(m){case "b":u.push("\b");t();break;
case "f":u.push("\f");t();break;case "n":u.push("\n");t();break;case "r":u.push("\r");t();break;case "t":u.push("\t");t();break;case "v":u.push("\v");t();break;case "\n":case "\r":u.push("\n");k();break;case "\\":case '"':case "'":u.push(m);t();break;case null:throw"unfinished string";case "z":for(t();lisspace(d());)t();break;case "x":throw"esacpe for char code not supported in lua.js yet.";default:if(!w.test(m))throw"invalid escape sequence"+m;throw"esacpe for char code not supported in lua.js yet.";
}break;default:u.push(m),t()}t();d=u.join("");return{id:q,val:d};case ".":g();if("."==e())return g(),"."==e()?(g(),v.TK_DOTS):v.TK_CONCAT;q=e();if(!w.test(q))return".";case "0":case "1":case "2":case "3":case "4":case "5":case "6":case "7":case "8":case "9":q=v.TK_NUMBER;d=e;t=g;u=d();t();if("0"!=u||"x"!=d()&&"X"!=d()){u=[u];for(l=d();w.test(l)||"."==l;)u.push(l),t(),l=d();d=parseFloat(u.join(""))}else throw t(),Error("Hexadecimal numeric not supported in lua.js yet.");return{id:q,val:d};case null:return v.TK_EOS;
default:q=e();if(y.test(q)){q=e;d=g;for(t=[];c(q());)t.push(q()),d();q=t.join("");return(d=n[q])?d:{id:v.TK_NAME,val:q}}q=e();g();return q}}function m(e){function c(){return d<e.length?e.charAt(d):null}function f(){d<e.length&&++d}var d=0;return function(){return l(c,f)}}d.tokens="<eof> and break do else elseif end false for function goto if in local nil not or repeat return then true until while .. ... == >= <= ~= :: <--orgion-eof> <number> <name> <string> __javascript".split(" ");var n={and:1,"break":2,
"do":3,"else":4,elseif:5,end:6,"false":7,"for":8,"function":9,"goto":10,"if":11,"in":12,local:13,nil:14,not:15,or:16,repeat:17,"return":18,then:19,"true":20,until:21,"while":22,__javascript:34,__js:34},v={TK_EOS:0,TK_AND:1,TK_BREAK:2,TK_DO:3,TK_ELSE:4,TK_ELSEIF:5,TK_END:6,TK_FALSE:7,TK_FOR:8,TK_FUNCTION:9,TK_GOTO:10,TK_IF:11,TK_IN:12,TK_LOCAL:13,TK_NIL:14,TK_NOT:15,TK_OR:16,TK_REPEAT:17,TK_RETURN:18,TK_THEN:19,TK_TRUE:20,TK_UNTIL:21,TK_WHILE:22,TK_CONCAT:23,TK_DOTS:24,TK_EQ:25,TK_GE:26,TK_LE:27,TK_NE:28,
TK_DBCOLON:29,TK_NUMBER:31,TK_NAME:32,TK_STRING:33,TK_JAVASCRIPT:34};d.TK=v;var y=/^[A-Za-z\_]$/,w=/^[0-9]$/,e=/^[0-9A-Za-z\_]$/;d.generator=m;d.lex=function(e){var c=m(e),f=c(),d=c();return{curr:function(){return f},lookAhead:function(){return d},next:function(){f=d;d=c()}}}})(x.lex);(function(d){function c(e){switch(typeof e){case "string":case "number":return e;case "object":return e.id}}function r(e){return"number"==typeof e?D[e]:"object"==typeof e?D[e.id]:e}function f(e){h(e,p.TK_NAME);var c=
e.curr().val;e.next();return{type:"variable",val:c}}function k(e,f){if(c(e.curr())==f)return e.next(),!0}function h(e,f){if(c(e.curr())!=f)throw Error("symbol "+r(f)+" expected!");}function l(e,c){h(e,c);e.next()}function m(e){h(e,p.TK_NAME);var c=e.curr().val;e.next();return c}function n(e){return{type:"const.string",val:m(e)}}function v(e){h(e,p.TK_STRING);var c=e.curr().val;e.next();return{type:"const.string",val:c}}function y(e){e.next();var c=q(e,0);l(e,"]");return c}function w(e){switch(c(e.curr())){case "(":e.next();
if(")"==e.curr())return e.next(),[];var f=C(e);l(e,")");return f;case "{":return[u(e)];case p.TK_STRING:return[v(e)];default:throw Error("function arguments expected, got "+r(e.curr()));}}function e(e){var g;a:switch(g=c(e.curr()),g){case "(":e.next();g=q(e,0);l(e,")");g={type:"expr.brackets",expr:g};break a;case p.TK_NAME:g=f(e);break a;case p.TK_JAVASCRIPT:e.next();g={type:"expr.javascript",args:w(e)};break a;default:throw Error("unexpected symbol "+(D[g]||g));}for(;;)switch(c(e.curr())){case ".":e.next();
var d=n(e);g={type:"expr.index",self:g,key:d};break;case "[":d=y(e);g={type:"expr.index",self:g,key:d};break;case ":":e.next();var d=n(e),k=w(e);g={type:"expr.callMethod",self:g,key:d,args:k};break;case "(":case "{":case p.TK_STRING:k=w(e);g={type:"expr.call",func:g,args:k};break;default:return g}}function A(e){switch(e.curr()){case "+":return 1;case "-":return 2;case "*":return 3;case "/":return 4;case "%":return 5;case "^":return 6;case p.TK_CONCAT:return 7;case p.TK_EQ:return 8;case "<":return 9;
case p.TK_LE:return 10;case p.TK_NE:return 11;case ">":return 12;case p.TK_GE:return 13;case p.TK_AND:return 14;case p.TK_OR:return 15}}function g(f){switch(c(f.curr())){case p.TK_NUMBER:var g=f.curr().val;f.next();return{type:"const.number",val:g};case p.TK_STRING:return v(f);case p.TK_NIL:return f.next(),{type:"const.nil"};case p.TK_TRUE:return f.next(),{type:"const.boolean",val:!0};case p.TK_FALSE:return f.next(),{type:"const.boolean",val:!1};case p.TK_DOTS:return f.next(),{type:"vararg"};case "{":return u(f);
case p.TK_FUNCTION:return f.next(),x(f);default:return e(f)}}function q(e,c){var f,d;a:{switch(e.curr()){case p.TK_NOT:d="uop.not";break a;case "-":d="uop.minus";break a;case "#":d="uop.len";break a}d=void 0}d?(e.next(),f=q(e,J),f={type:"expr.uop",op:d,operand:f}):f=g(e);for(d=A(e);d&&H[d][0]>c;){e.next();var k=q(e,H[d][1]);f={type:"expr.op",op:I[d],left:f,right:k};d=A(e)}return f}function C(e){var c=[];for(c.push(q(e,0));k(e,",");)c.push(q(e,0));return c}function t(e){var f;f=c(e.curr())==p.TK_NAME?
n(e):y(e);l(e,"=");return{type:"field.rec",key:f,val:q(e,0)}}function u(e){l(e,"{");var f=[];do{if("}"==e.curr())break;var g;a:{g=e;var d=g.curr();switch(c(d)){case p.TK_NAME:g="="!=g.lookAhead()?{type:"field.list",val:q(g,0)}:t(g);break a;case "[":g=t(g);break a;default:g={type:"field.list",val:q(g,0)}}}g&&f.push(g)}while(k(e,",")||k(e,";"));l(e,"}");return{type:"expr.constructor",fields:f}}function F(c){switch(c.curr()){case ";":c.next();break;case p.TK_IF:var g={type:"stat.if"},d=g;c.next();var h=
d;h.cond=q(c,0);l(c,p.TK_THEN);for(h.tblock=z(c);k(c,p.TK_ELSEIF);){d.fblock={type:"block",stats:[{type:"stat.if"}]};var d=d.fblock.stats[0],h=c,A=d;A.cond=q(h,0);l(h,p.TK_THEN);A.tblock=z(h)}k(c,p.TK_ELSE)&&(d.fblock=z(c));l(c,p.TK_END);return g;case p.TK_WHILE:return c.next(),g=q(c,0),l(c,p.TK_DO),d=z(c),l(c,p.TK_END),{type:"stat.while",cond:g,block:d};case p.TK_DO:return c.next(),g=z(c),l(c,p.TK_END),g;case p.TK_FOR:c.next();d=m(c);switch(c.curr()){case "=":c.next();h=q(c,0);l(c,",");A=q(c,0);
k(c,",")&&(g=q(c,0));g={type:"stat.fornum",varname:d,from:h,to:A,step:g};break;case ",":case p.TK_IN:for(g=[d];k(c,",");)g.push(m(c));l(c,p.TK_IN);g={type:"stat.forlist",varnames:g,explist:C(c)};break;default:throw"`=` or `in` expected";}l(c,p.TK_DO);g.block=z(c);l(c,p.TK_END);return g;case p.TK_REPEAT:return c.next(),g=z(c),l(c,p.TK_UNTIL),{type:"stat.repeat",until:q(c,0),block:g};case p.TK_FUNCTION:c.next();for(g=f(c);k(c,".");)d=n(c),g={type:"expr.index",self:g,key:d};k(c,":")?(d=n(c),g={type:"stat.method",
self:g,key:d}):g={type:"stat.function",left:g};g.func=x(c);return g;case p.TK_LOCAL:c.next();if(k(c,p.TK_FUNCTION))return{type:"stat.localfunction",name:m(c),func:x(c)};g=[];do g.push(m(c));while(k(c,","));k(c,"=")&&(d=C(c));return{type:"stat.local",names:g,right:d};case p.TK_RETURN:g={type:"stat.return",nret:[]};c.next();G(c)||";"==c.curr()||(g.nret=C(c));for(;k(c,";"););return g;case p.TK_BREAK:return c.next(),{type:"stat.break"};default:g=e(c);if("="==c.curr()||","==c.curr()){for(g=[g];k(c,",");)g.push(e(c));
l(c,"=");c={type:"stat.assignment",lefts:g,right:C(c)}}else{if("expr.call"!=g.type&&"expr.callMethod"!=g.type&&"expr.javascript"!=g.type)throw Error("syntax error, unexpected expr type "+g.type);c={type:"stat.expr",expr:g}}return c}}function G(e){switch(e.curr()){case p.TK_ELSE:case p.TK_ELSEIF:case p.TK_END:case p.TK_EOS:case p.TK_UNTIL:return!0;default:return 0}}function z(e){for(var c=[];!G(e);){if(e.curr()==p.TK_RETURN){c.push(F(e));break}var g=F(e);g&&c.push(g)}return{type:"block",stats:c}}function x(e){l(e,
"(");var g=[];if(")"!=e.curr()){do switch(c(e.curr())){case p.TK_NAME:g.push(m(e));break;case p.TK_DOTS:g.push(p.TK_DOTS);e.next();break;default:throw"<name> or `...` expected";}while(k(e,","))}var f=!1;0<g.length&&g[g.length-1]==p.TK_DOTS&&(g.pop(),f=!0);l(e,")");var d=z(e);l(e,p.TK_END);return{type:"function",args:g,varargs:f,block:d}}var E=B("./lex.js"),K=E.lex,p=E.TK,D=E.tokens,H=[null,[6,6],[6,6],[7,7],[7,7],[7,7],[10,9],[5,4],[3,3],[3,3],[3,3],[3,3],[3,3],[3,3],[2,2],[1,1]],I=[null,"op.add",
"op.minus","op.mul","op.div","op.mod","op.pow","op.concat","op.equal","op.less","op.lessequal","op.notequal","op.great","op.greatequal","op.and","op.or"];d.opname=I;var J=8;d.main=function(e){var c={type:"function",args:[],varargs:!0,block:z(e)};h(e,p.TK_EOS);return c};d.parse=function(e){return d.main(K(e))}})(x.parser);(function(d){function c(e){return"const.number"==e.type?h(e):"l.__checknumber("+f(e)+")"}function r(e){if("vararg"==e.type||"expr.call"==e.type||"expr.callMethod"==e.type)return!0}
function f(e){return r(e)?"("+h(e)+")[0]":h(e)}function k(e){if(e.length&&r(e[e.length-1])){if(1==e.length)return h(e[0]);for(var c=[],g=0;g<e.length-1;g++)c.push(f(e[g]));return"["+c.join(",")+"].concat("+h(e[e.length-1])+")"}c=[];for(g=0;g<e.length;g++)c.push(f(e[g]));return"["+c.join(",")+"]"}function h(e){if(m[e.type])return m[e.type](e);throw Error("Unsupported ast type "+e.type);}function l(e,c){return function(g){function f(g,d){if(g&&g.constructor==Array){for(var k=0;k<g.length;k++)g[k]=f(g[k],
d);return g}if(g&&g.type){var h=e(g,d)||g,l=w[h.type];if(l)for(k=0;k<l.length;k++)h[l[k]]=f(h[l[k]],h);c&&(h=c(h,d)||h);return h}}return f(g)}}var m={},n,v,y;n="\n";v=function(){n+="    "};y=function(){n=n.substr(0,n.length-4)};m["function"]=function(e){return"function("+e.args.join(",")+")"+h(e.block)};m.block=function(e){var c=[];v();for(var g=0;g<e.stats.length;g++)c.push(h(e.stats[g]));y();return n+"{"+c.join("")+n+"}"};m["stat.getvaargs"]=function(e){return n+"var __VA_ARG = Array.prototype.slice.call(arguments, "+
e.argCount+");"};m["stat.expr"]=function(e){return n+h(e.expr)+";"};m["stat.local"]=function(e){if(e.right){if(1==e.names.length)return n+"var "+e.names[0]+" = "+f(e.right[0])+";";for(var c=[],g=0;g<e.names.length;g++)c.push(e.names[g]+" = t["+g+"]");return n+"var t ="+k(e.right)+","+n+c.join(",")+";"}return n+"var "+e.names.join(",")+";"};m["stat.if"]=function(e){var c=n+"if ("+f(e.cond)+")"+h(e.tblock);return e.fblock&&0<e.fblock.stats.length?1==e.fblock.stats.length&&"stat.if"==e.fblock.stats[0].type?
c+"else"+h(e.fblock.stats[0]):c+"else"+h(e.fblock):c};m["stat.fornum"]=function(e){if(e.step){v();var f=n+e.varname+" = "+e.$var+";"+h(e.block)+n+e.$var+" += "+e.$step;y();return n+"var "+e.$var+" = "+c(e.from)+", "+e.$limit+" = "+c(e.to)+", "+e.$step+" = "+c(e.step)+","+e.varname+";"+n+"while (("+e.$step+">0 && "+e.$var+"<="+e.$limit+") || ("+e.$step+"<0 && "+e.$var+">="+e.$limit+")){"+f+n+"}"}return n+"for (var "+e.varname+", "+e.$var+" = "+c(e.from)+", "+e.$limit+" = "+c(e.to)+";("+e.varname+"="+
e.$var+")<="+e.$limit+";++"+e.$var+")"+h(e.block)};m["stat.forlist"]=function(e){v();var c=e.$st,g=[];g.push(n+"var t = "+c+"[0]("+c+"[1],"+c+"[2]);");for(var f=0;f<e.varnames.length;++f)g.push(n+"var "+e.varnames[f]+" = t["+f+"];");g.push(n+"if ("+e.varnames[0]+" == null) break;");g.push(n+c+"[2] = "+e.varnames[0]+";");g.push(h(e.block));y();return n+"var "+c+" = "+k(e.explist)+";"+n+"for (;;)"+n+"{"+g.join("")+n+"}"};m["stat.while"]=function(e){return n+"while ("+f(e.cond)+")"+h(e.block)};m["stat.repeat"]=
function(e){return n+"do "+h(e.block)+"while (!("+f(e.until)+"));"};m["stat.break"]=function(e){return n+"break;"};m.vararg=function(e){return"__VA_ARG"};m["stat.return"]=function(e){var c=e.nret;if(c.length&&r(c[c.length-1]))return n+"return "+k(e.nret);for(var c=[],g=0;g<e.nret.length;g++)c.push(f(e.nret[g]));return n+"return ["+c+"];"};m["stat.assignment"]=function(e){if(1==e.lefts.length){var c=1==e.right.length?f(e.right[0]):k(e.right)+"[0]";if("expr.index"==e.lefts[0].type){var g=e.lefts[0];
return n+"l.__set("+f(g.self)+", "+h(g.key)+", "+c+");"}return n+h(e.lefts[0])+" = "+c+";"}c=[];c.push(n+"var t = "+k(e.right)+";");for(var d=0;d<e.lefts.length;++d)"expr.index"==e.lefts[d].type?(g=e.lefts[d],c.push(n+"l.__set("+f(g.self)+","+h(g.key)+",t["+d+"]);")):c.push(n+h(e.lefts[d])+" = t["+d+"];");return c.join("")};m["expr.index"]=function(e){return"l.__get("+f(e.self)+","+h(e.key)+")"};m["expr.op"]=function(e){var c,g;switch(e.op){case "op.add":c="l.__add";break;case "op.minus":c="l.__sub";
break;case "op.mul":c="l.__mul";break;case "op.div":c="l.__div";break;case "op.mod":c="l.__mod";break;case "op.pow":c="l.__pow";break;case "op.concat":c="l.__concat";break;case "op.equal":c="l.__eq";break;case "op.less":c="l.__lt";break;case "op.lessequal":c="l.__le";break;case "op.notequal":c="l.__neq";break;case "op.great":c="l.__gt";break;case "op.greatequal":c="l.__ge";break;case "op.and":g="&&";break;case "op.or":g="||";break;default:throw Error(e.op+" is not implemented yet.");}if(g)return f(e.left)+
g+f(e.right);if(c)return c+"("+f(e.left)+","+f(e.right)+")"};m["expr.uop"]=function(c){switch(c.op){case "uop.minus":return"l.__unm("+f(c.operand)+")";case "uop.not":return"!("+f(c.operand)+")";case "uop.len":return"l.__len("+f(c.operand)+")";default:throw Error(c.op+" is not implemented yet.");}};m["expr.call"]=function(c){return"l.__call("+f(c.func)+","+k(c.args)+")"};m["expr.callMethod"]=function(c){return"l.__callMethod("+f(c.self)+","+f(c.key)+","+k(c.args)+")"};m["expr.brackets"]=function(c){return r(c.expr)?
f(c.expr):"("+h(c.expr)+")"};m["expr.constructor"]=function(c){if(!c.fields.length)return"l.__newTable()";for(var d=[],g=0;g<c.fields.length;g++){var k=c.fields[g];if("field.list"==k.type)r(k.val)&&g==c.fields.length-1?d.push("[2, "+h(k.val)+"]"):d.push("[0, "+f(k.val)+"]");else if("field.rec"==k.type)d.push("[1, "+h(k.key)+","+f(k.val)+"]");else throw Error("Invalid field type "+k.type);}return"l.__newTable(["+d.join(",")+"])"};m.variable=function(c){return c.val};m["const.string"]=function(c){return c.val?
JSON.stringify(c.val):"l.ds"};m["const.number"]=function(c){return c.val?JSON.stringify(c.val):"l.d0"};m["const.boolean"]=function(c){return JSON.stringify(c.val)};m["const.nil"]=function(c){return"null"};m["expr.javascript"]=function(c){if(1!=c.args.length)throw Error("__javascript should have exactly one arguments.");return"const.string"==c.args[0].type?"("+c.args[0].val+")":"eval("+f(c.args[0])+")"};var w={"expr.uop":["operand"],"expr.op":["left","right"],"stat.assignment":["lefts","right"],"stat.expr":["expr"],
"field.list":["val"],"field.rec":["key","val"],"expr.constructor":["fields","recs","list"],"stat.if":["cond","tblock","fblock"],"stat.fornum":["from","to","step","block"],"stat.forlist":["explist","block"],"stat.while":["cond","block"],"stat.repeat":["until","block"],"expr.index":["self","key"],"expr.callMethod":["self","key","args"],"expr.call":["func","args"],"expr.brackets":["expr"],"stat.method":["self","key","func"],"stat.function":["left","func"],"stat.localfunction":["func"],"stat.local":["right"],
"stat.return":["nret"],"function":["block"],block:["stats"]};d.traverse=l;d.phases=[];d.postphases=[];d.run=function(c){for(var f=0;f<d.phases.length;f++)c=d.phases[f](c);c=h(c);for(f=0;f<d.postphases.length;f++)c=d.postphases[f](c);return c};(function(){d.phases.push(l(function(c){switch(c.type){case "function":c.varargs&&c.block.stats.unshift({type:"stat.getvaargs",argCount:c.args.length});c=c.block.stats;0!=c.length&&"stat.return"==c[c.length-1].type||c.push({type:"stat.return",nret:[]});break;
case "block":for(var f=[],g=0;g<c.stats.length;g++){var d=c.stats[g];switch(d.type){case "stat.localfunction":f.push({type:"stat.local",names:[d.name]});f.push({type:"stat.assignment",lefts:[{type:"variable",val:d.name}],right:[d.func]});break;case "stat.function":f.push({type:"stat.assignment",lefts:[d.left],right:[d.func]});break;case "stat.method":d.func.args.unshift("self");f.push({type:"stat.assignment",lefts:[{type:"expr.index",self:d.self,key:d.key}],right:[d.func]});break;default:f.push(c.stats[g])}}c.stats=
f}}))})();(function(){d.phases.push(function(c){var f=[],g,d={},k=0;return c=l(function(c){var e;switch(c.type){case "block":e=[];break;case "function":e=c.args;break;case "stat.fornum":e=[c.varname,"$var","$limit","$step"];break;case "stat.forlist":e=c.varnames;e.push("$st");break;case "variable":if(d[c.val]){var h;e=d[c.val];"fornum"==g.curr.type||"forlist"==g.curr.type?e[e.length-1]!=g.curr?h=e[e.length-1]:1<e.length&&(h=e[e.length-2]):h=e[e.length-1];if(h){c.val=c.val+"$"+h.id;return}}return"_ENV"==
c.val?void 0:{type:"expr.index",self:{type:"variable",val:"_ENV"},key:{type:"const.string",val:c.val}}}if(e){g&&f.push(g);g={curr:c,names:e.slice(0)};for(h=0;h<e.length;h++){var l=e[h];d[l]=d[l]||[];var m=++k;e[h]=l+"$"+m;d[l].push({id:m,curr:c})}"stat.fornum"==c.type?(c.varname=e[0],c.$var=e[1],c.$limit=e[2],c.$step=e[3]):"stat.forlist"==c.type&&(c.$st=e.pop())}},function(c){if(g&&g.curr==c){for(var e=0;e<g.names.length;e++){var h=g.names[e];d[h].pop();0==d[h].length&&delete d[h]}g=f.pop()}else if("stat.local"==
c.type)for(e=0;e<c.names.length;e++){h=c.names[e];d[h]=d[h]||[];var l=d[h];if(0<l.length&&l[l.length-1]===g){var m=l[l.length-1].id=++k;c.names[e]=h+"$"+m}else m=++k,c.names[e]=h+"$"+m,l.push({id:m,curr:g.curr}),g.names.push(h)}})(c)})})();(function(){d.postphases.push(function(c){return"(function(_ENV, l){return "+c+";})"})})();d.sign="/*lua.js generated code*/";(function(){d.postphases.push(function(c){return"/*lua.js generated code*/"+c})})()})(x.codegen);(function(d){function c(c){this.stringMap=
{};this.array=[];this.hashMap={};this.metatable=null;this._hashKey=++k;if(c)for(var f=0;f<c.length;f++){var d=c[f];if(0==d[0])this.array.push(d[1]);else if(1==d[0])this.set(d[1],d[2]);else for(var n=0;n<d[1].length;n++)this.array.push(d[1][n])}}var r={_hashKey:-1,valueOf:function(){return 0},toString:function(){return"0"}},f={_hashKey:-2,toString:function(){return""}};d.dummy0=r;d.dummyStr=f;var k=0;d.LuaTable=c;d.newHashKey=function(){return++k};c.prototype={};c.prototype.constructor=c;c.prototype.get=
function(c){if(null==c)throw Error("table index is nil");switch(typeof c){case "number":return this.array[c-1];case "string":return this.stringMap[c];case "object":if(c==r)return this.array[-1];if(c==f)return this.stringMap[c];case "function":return c._hashKey||(c._hashKey=++k),(c=this.hashMap[c._hashKey])&&c[1];default:throw Error("get with a invalid argument"+c);}};c.prototype.set=function(c,f){if(null==c)throw Error("table index is nil");if(null==f)switch(typeof c){case "number":c==this.array.length?
this.array.pop():delete this.array[c-1];break;case "string":delete this.stringMap[c];break;case "object":case "function":if(!c._hashKey)break;delete this.hashMap[c._hashKey];break;default:throw Error("set with a invalid argument"+c);}else switch(typeof c){case "number":this.array[c-1]=f;break;case "string":this.stringMap[c]=f;break;case "object":case "function":c._hashKey||(c._hashKey=++k);this.hashMap[c._hashKey]=[c,f];break;default:throw Error("set with a invalid argument"+c);}};c.prototype.length=
function(){for(var c=this.array.length;0<c&&null==this.array[c-1];--c);c!=this.array.length&&(this.array.length=c);return this.array.length};c.prototype.toString=function(){return"table "+this._hashKey}})(x.types);(function(d){function c(c){return c.substr(0,h.length)!=h?k.run(f.parse(c)):c}function r(){function f(c,d){var k=e.__getmetatable(c);return k&&k.stringMap&&k.stringMap[d]}function h(c,d){e[c]=function(k,h){var l=e.__tonumber(k),n=e.__tonumber(h);if(l&&n)return d(l,n)||m;if(l=f(k,c)||f(h,
c))return l(k,h)[0];throw Error("attempt to perform arithmetic on a "+e.__type(k)+" value");}}if(!(this instanceof r))return new r;var w=new l.LuaTable;this._G=w;w.set("_G",w);w.set("_VERSION","Lua 5.2");w.set("_LUAJS","Lua.js 0.1");var e={};e.d0=m;e.ds=n;var x=new l.LuaTable;w.set("string",x);e.__getmetatable=function(c){if(!c)return null;switch(typeof c){case "object":return c.metatable;case "string":return x;default:return null}};e.__get=function(c,d){var k;if("table"==e.__type(c)){if(k=c.get(d))return k;
k=f(c,"__index");if(!k)return null}else if(k=f(c,"__index"),!k)throw Error("attempt to index a "+e.__type(c)+" value.");return"function"==typeof k?k(c,d)[0]:e.__get(k,d)};e.__set=function(c,d,k){var h;if("table"==e.__type(c)){if(c.get(d)){c.set(d,k);return}h=f(c,"__newindex");if(!h){c.set(d,k);return}}else if(h=f(c,"__newindex"),!h)throw Error("attempt to index a "+e.__type(c)+" value.");"function"==typeof h?h(c,d,k):e.__set(h,d,k)};h("__add",function(c,e){return c+e});h("__mul",function(c,e){return c*
e});h("__sub",function(c,e){return c-e});h("__div",function(c,e){return c/e});h("__mod",function(c,e){return c%e});h("__pow",function(c,e){return Math.pow(c,e)});e.__unm=function(c){var d=e.__tonumber(c);if(d)return-d;if(d=f(c).__unm)return d(c)[0];throw Error("attempt to perform arithmetic on a "+e.__type(c)+" value");};e.__eq=function(c,f){return!e.__neq(c,f)};e.__neq=function(c,d){if(c===d)return!1;var k=e.__type(c),h=e.__type(d);if(k!=h||"table"!=k&&"userdata"!=k)return!0;k=f(c,"__eq");h=f(d,
"__eq");return k&&k==h?!k(c,d)[0]:!0};e.__gt=function(c,f){return e.__lt(f,c)};e.__ge=function(c,f){return e.__le(f,c)};e.__lt=function(c,d){var k=e.__type(c),h=e.__type(d);if("number"==k&&"number"==h||"string"==k&&"string"==h)return c<d;if(k=f(c,"__lt")||f(c,"__lt"))return!!k(c,d)[0];throw Error("attempt to compare "+e.__type(c)+" with "+e.__type(d));};e.__le=function(c,d){var k=e.__type(c),h=e.__type(d);if("number"==k&&"number"==h||"string"==k&&"string"==h)return c<=d;if(k=f(c,"__le")||f(c,"__le"))return!!k(c,
d)[0];if(k=f(c,"__lt")||f(c,"__lt"))return!k(d,c)[0];throw Error("attempt to compare "+e.__type(c)+" with "+e.__type(d));};e.__concat=function(c,d){var k=e.__type(c),h=e.__type(d);if(!("number"!=k&&"string"!=k||"number"!=h&&"string"!=h))return""+c+d||n;if(k=f(c,"__concat")||f(d,"__concat"))return k(c,d)[0];throw Error("attempt to concatenate a "+e.__type(c)+" value");};e.__newTable=function(c){return new l.LuaTable(c)};e.__len=function(c){switch(typeof c){case "string":return c.length}var d=f(c,"__len");
if(d)return d(a)[0];if(c.constructor==l.LuaTable)return c.length();throw Error("attempt to get length of a "+e.__type(a)+" value");};e.__tonumber=function(c){switch(typeof c){case "number":return c;case "string":try{return parseInt(s)||m}catch(e){break}default:if(c==m)return c}return null};e.__checknumber=function(c){switch(typeof c){case "number":return c;case "string":try{return parseInt(s)}catch(e){}}if(c==m)return c;throw Error("Not a number.");};e.__tostring=function(c){if(null==c)return"nil";
switch(typeof c){case "number":case "boolean":return c.toString();case "string":return c;case "function":return c._hashKey=c._hashKey||l.newHashKey(),"function("+c._hashKey+")";case "object":if(c==m)return"0";if(c==n)return n;var e=f(c,"__tostring");if(e)return e(c)[0];if(c.toString)return c.toString();default:return"userdata("+c+")"}};e.__type=function(c){if(null==c)return"nil";var e=typeof c;switch(e){case "number":case "boolean":case "string":case "function":return e;case "object":if(c==m)return"number";
if(c==n)return n;if(c.constructor==l.LuaTable)return"table";default:return"userdata"}};e.__call=function(c,d){if("function"==typeof c)return c.apply(null,d);var k=f(c,"__call");if(k)return d.unshift(k),k(d);throw Error("attempt to call a "+e.__type(c)+" value");};e.__callMethod=function(c,f,d){d.unshift(c);e.__call(e.__get(c,f),d)};e.__dump=function(c){if("function"!=typeof c)throw Error("bad argument #1 to `dump` (function expected, got "+e.__type(c)+")");return k.sign+"(function(_ENV, l){return "+
c.toString()+";})"};this.loadString=e.__loadString=function(f,d){f=c(f);return eval(f)(d||w,e)};this.loadStdLib=function(){if(!d.stdlib){var c=B("fs"),f=B("path"),c=c.readFileSync(f.join(f.dirname(module.filename),"./stdlib.lua"),{encoding:"utf-8"});d.stdlib=eval(d.compile(c))}d.stdlib(w,e)()}}var f=B("./parser.js");d.parser=f;var k=B("./codegen.js");d.codegen=k;var h=k.sign;d.compile=c;var l=B("./types.js");d.types=l;var m=l.dummy0,n=l.dummyStr;r.prototype={};d.LuaContext=d.newContext=r})(x.index);
x.index.stdlib=function(d,c){return function(){Array.prototype.slice.call(arguments,0);c.__set(d,"assert",function(f,k){f||c.__call(c.__get(d,"error"),[k||"Assertion failed!"]);return[]});c.__set(d,"collectgarbage",function(){return[]});var r;r=function(f){c.__call(c.__get(d,"error"),["Not implemented"]);return[]};c.__set(d,"dofile",r);c.__set(d,"error",function(c){throw Error(c);});c.__set(d,"getmetatable",function(c){return[c&&c.metatable]});c.__set(d,"ipairs",function(f){return[function(f,d){return c.__ge(d,
c.__len(f))?[]:[c.__add(d,1),c.__get(f,c.__add(d,1))]},f,c.d0]});c.__set(d,"loadString",function(f,d){return[c.__loadString(f,d)]});c.__set(d,"load",function(f,k,h,l){if(c.__eq(c.__call(c.__get(d,"type"),[f])[0],"function")){k=c.__newTable();for(f=[f];;){h=f[0](f[1],f[2])[0];if(null==h)break;f[2]=h;c.__call(c.__get(c.__get(d,"table"),"insert"),[c.__get(d,"chunk"),h])}f=c.__call(c.__get(c.__get(d,"table"),"concat"),[k])[0]}return c.__call(c.__get(d,"loadString"),[f,l])});c.__set(d,"loadfile",r);c.__set(d,
"next",r);c.__set(d,"pairs",r);c.__set(d,"pcall",function(c){var d=Array.prototype.slice.call(arguments,1);try{var h=c.apply(null,d);h.unshift(!0);return h}catch(l){return[!1,l]}});c.__set(d,"print",function(){for(var f=Array.prototype.slice.call(arguments,0),f=c.__newTable([[2,f]]),k,h=1,l=c.__checknumber(c.__len(f));(k=h)<=l;++h)c.__set(f,k,c.__call(c.__get(d,"tostring"),[c.__get(f,k)])[0]);c.__call(c.__get(c.__get(d,"io"),"write"),c.__call(c.__get(c.__get(d,"table"),"concat"),[f," "]));c.__call(c.__get(c.__get(d,
"io"),"write"),["\n"]);return[]});c.__set(d,"rawequal",function(c,d){return[c===d]});c.__set(d,"rawget",function(f,d){var h=c.__type(f);if("table"!=h)throw Error("rawget called with type "+h);return[f.get(d)]});c.__set(d,"rawlen",function(f){var d=c.__type(f);if("table"!=d)throw Error("rawlen called with type "+d);return[f.length()]});c.__set(d,"rawset",function(f,d,h){var l=c.__type(f);if("table"!=l)throw Error("rawget called with type "+l);f.set(d,h);return[f]});c.__set(d,"select",function(c){return"#"==
c?arguments.length:arguments[c]});c.__set(d,"setmetatable",function(c,d){if("object"!=typeof c)throw Error("Cannot set metatable to non-object values.");c.metatable=d;return[]});c.__set(d,"tonumber",function(f){return[c.__tonumber(f)]});c.__set(d,"tostring",function(f){return[c.__tostring(f)]});c.__set(d,"type",function(f){return[c.__type(f)]});c.__set(d,"xpcall",function(c,d){var h=Array.prototype.slice.call(arguments,2);try{return c.apply(null,h)}catch(l){return d(l)}});c.__set(d,"package",c.__newTable());
c.__set(c.__get(d,"package"),"loaded",c.__newTable());c.__set(c.__get(d,"package"),"preload",c.__newTable());c.__set(d,"require",function(f){var k=c.__get(c.__get(c.__get(d,"package"),"loaded"),f);if(k)return[k];for(var h,l,k=c.__call(c.__get(d,"ipairs"),[c.__get(c.__get(d,"package"),"searchers")]);;){var m=k[0](k[1],k[2]),n=m[0],m=m[1];if(null==n)break;k[2]=n;m=c.__call(m,[f]);h=m[0];l=m[1];if(h)break}h=c.__call(h,[f,l])[0];c.__set(c.__get(c.__get(d,"package"),"loaded"),f,c.__get(c.__get(c.__get(d,
"package"),"loaded"),f)||h);return[c.__get(c.__get(c.__get(d,"package"),"loaded"),f)]});c.__set(c.__get(d,"string"),"byte",function(f,d,h){if("string"!=typeof f&&(f=c.__tostring(f),f==c.ds))return[];d=d||1;h=h||d;0>d?d=f.length+d:d--;0>h&&(h=f.length+h+1);for(var l=[];d<h;++d){var m=f.charCodeAt(d);m&&l.push(m)}return l});c.__set(c.__get(d,"string"),"dump",function(f){return[c.__dump(f)]});c.__set(c.__get(d,"string"),"find",function(c,d,h,l){if(l)return[c.indexOf(d,h&&h-1)+1];throw Error("Not implemented.");
});c.__set(c.__get(d,"string"),"len",function(d){"string"!=typeof d&&d!=c.ds&&(d=c.__tostring(d));return d==c.ds?[0]:[d.length]});c.__set(c.__get(d,"string"),"lower",function(d){"string"!=typeof d&&d!=c.ds&&(d=c.__tostring(d));return d==c.ds?[d]:[d.toLowerCase()]});c.__set(c.__get(d,"string"),"upper",function(d){"string"!=typeof d&&d!=c.ds&&(d=c.__tostring(d));return d==c.ds?[d]:[d.toUpperCase()]});c.__set(c.__get(d,"string"),"rep",function(c,d,h){return h?Array(d).join(c+h)+c:Array(d+1).join(c)});
c.__set(c.__get(d,"string"),"reverse",function(d){"string"!=typeof d&&d!=c.ds&&(d=c.__tostring(d));return d==c.ds?[d]:[d.split("").reverse().join("")]});c.__set(c.__get(d,"string"),"sub",function(d,k,h){"string"!=typeof d&&d!=c.ds&&(d=c.__tostring(d));if(d==c.ds)return[d];h=h||d.length;0>k?k=d.length+k:k--;0>h&&(h=d.length+h+1);return d.substring(d,k,h)});c.__set(d,"table",c.__newTable());c.__set(c.__get(d,"table"),"concat",function(c,d,h,l){c=c.array;h&&(c=l?c.slice(h-1,l-1):c.slice(h-1));return[c.join(d||
"")]});c.__set(c.__get(d,"table"),"insert",function(c,d,h){d?c.array.splice(d-1,0,h):c.array.push(h);return[]});c.__set(c.__get(d,"table"),"pack",function(){return[Array.prototype.slice.call(arguments,0)]});c.__set(d,"pack",c.__get(c.__get(d,"table"),"pack"));c.__set(c.__get(d,"table"),"remove",function(c,d){return d?c.array.splice(d-1,1):[c.array.pop()]});c.__set(c.__get(d,"table"),"sort",function(d,k){k?d.array.sort(function(){return k(a,b)[0]?-1:k(b,a)[0]?1:0}):d.array.sort(function(d,f){return c.__lt(d,
f)?-1:c.__lt(f,d)?1:0})});c.__set(c.__get(d,"table"),"unpack",function(c){return c.array});c.__set(d,"math",c.__newTable());c.__set(c.__get(d,"math"),"abs",function(c){return[Math.abs(c)]});c.__set(c.__get(d,"math"),"acos",function(c){return[Math.acos(c)]});c.__set(c.__get(d,"math"),"asin",function(c){return[Math.asin(c)]});c.__set(c.__get(d,"math"),"atan",function(c){return[Math.atan(c)]});c.__set(c.__get(d,"math"),"atan2",function(c,d){return[Math.atan2(c,d)]});c.__set(c.__get(d,"math"),"ceil",
function(c){return[Math.ceil(c)]});c.__set(c.__get(d,"math"),"cos",function(c){return[Math.cos(c)]});c.__set(c.__get(d,"math"),"cosh",function(c){return[Math.cosh(c)]});c.__set(c.__get(d,"math"),"deg",function(c){return[180*c/Math.PI]});c.__set(c.__get(d,"math"),"exp",function(c){return[Math.exp(c)]});c.__set(c.__get(d,"math"),"floor",function(c){return[Math.floor(c)]});c.__set(c.__get(d,"math"),"log",function(c,d){return[d?Math.log(c)/Math.log(d):Math.log(c)]});c.__set(c.__get(d,"math"),"max",function(){return[Math.max.apply(null,
arguments)]});c.__set(c.__get(d,"math"),"min",function(c){return[Math.min.apply(null,arguments)]});c.__set(c.__get(d,"math"),"pi",Math.PI);c.__set(c.__get(d,"math"),"pow",function(c,d){return[Math.pow(c,d)]});c.__set(c.__get(d,"math"),"rad",function(c){return[c*Math.PI/180]});c.__set(c.__get(d,"math"),"random",function(c,d){return c?d?[Math.floor(Math.random()*(d-c+1))+c]:[Math.floor(Math.random()*c)+1]:[Math.random()]});c.__set(c.__get(d,"math"),"sin",function(c){return[Math.sin(c)]});c.__set(c.__get(d,
"math"),"sinh",function(c){return[Math.sinh(c)]});c.__set(c.__get(d,"math"),"sqrt",function(c){return[Math.sqrt(c)]});c.__set(c.__get(d,"math"),"tan",function(c){return[Math.tan(c)]});c.__set(c.__get(d,"math"),"tanh",function(c){return[Math.tanh(c)]});c.__set(d,"bit32",c.__newTable());c.__set(c.__get(d,"bit32"),"arshift",function(c,d){return[c<<d]});c.__set(c.__get(d,"bit32"),"band",function(c){for(var d=1;d<arguments.length;d++)c&=arguments[d];return[c]});c.__set(c.__get(d,"bit32"),"bnot",function(c){return[~c]});
c.__set(c.__get(d,"bit32"),"bor",function(c){for(var d=1;d<arguments.length;d++)c|=arguments[d];return[c]});c.__set(c.__get(d,"bit32"),"btest",function(c){for(var d=1;d<arguments.length;d++)c&=arguments[d];return[0!=c]});c.__set(c.__get(d,"bit32"),"bxor",function(c){for(var d=1;d<arguments.length;d++)c^=arguments[d];return[0!=c]});c.__set(d,"io",c.__newTable());c.__set(c.__get(d,"io"),"write",function(c){console.log(c)});c.__set(c.__get(d,"io"),"flush",function(){return[]});c.__set(d,"os",c.__newTable());
c.__set(c.__get(d,"os"),"clock",function(){var c=Date.now();return function(){return[(Date.now()-c)/1E3]}}());c.__set(c.__get(d,"os"),"difftime",function(d,k){return[c.__sub(d,k)]});c.__set(c.__get(d,"os"),"time",function(){return[Date.now()/1E3]});return[]}};window.luajs=x.index})();
